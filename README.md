# Three.js -  React Three Fiber

React - Data binding- application react to the data (event triggering)

* [Three.js Docs](https://threejs.org/docs/)
* [React Three Fiber Docs](https://docs.pmnd.rs/react-three-fiber/getting-started/introduction)
* [React Three Fiber Repository](https://github.com/pmndrs/react-three-fiber)


1. [React](https://github.com/ivanxavier7/react-three-fiber#1---react)
    1. [Setup](https://github.com/ivanxavier7/react-three-fiber#11---setup)

        1. [NPX-Node](https://github.com/ivanxavier7/react-three-fiber#111---npx)
        2. [Scratch](https://github.com/ivanxavier7/react-three-fiber#112---scratch)
        3. [Vite - Recommended](https://github.com/ivanxavier7/react-three-fiber#113---vite)

    2. [JSX](https://github.com/ivanxavier7/react-three-fiber#12---event-reacting)
    3. [Conditional rendering](https://github.com/ivanxavier7/react-three-fiber#13---conditional-rendering)
    4. [Properties](https://github.com/ivanxavier7/react-three-fiber#14---properties)
    5. [Mapping cycle](https://github.com/ivanxavier7/react-three-fiber#15---mapping-cycle)
    6. [Cache](https://github.com/ivanxavier7/react-three-fiber#16---cache)
    7. [DOM](https://github.com/ivanxavier7/react-three-fiber#17---dom)
    8. [People component](https://github.com/ivanxavier7/react-three-fiber#18---people-component)
    9. [Fetch API](https://github.com/ivanxavier7/react-three-fiber#19---fetch-api)


2. [R3F Simple Application](https://github.com/ivanxavier7/react-three-fiber#2---r3f-simple-application)
    1. [Setup](https://github.com/ivanxavier7/react-three-fiber#21---setup)
    2. [Implementation](https://github.com/ivanxavier7/react-three-fiber#22---implementation)
    3. [Animate](https://github.com/ivanxavier7/react-three-fiber#23---animate)
    4. [OrbitControls](https://github.com/ivanxavier7/react-three-fiber#24---orbitcontrols)
    5. [Lights](https://github.com/ivanxavier7/react-three-fiber#25---lights)
    6. [Custom Geometry](https://github.com/ivanxavier7/react-three-fiber#26---custom-geometry)
    7. [Canvas](https://github.com/ivanxavier7/react-three-fiber#27---canvas)

        1. [Animating Camera](https://github.com/ivanxavier7/react-three-fiber#271---animating-camera)
        2. [Antialias](https://github.com/ivanxavier7/react-three-fiber#272---antialias)
        3. [ToneMapping](https://github.com/ivanxavier7/react-three-fiber#273---tonemapping)
        4. [Encoding](https://github.com/ivanxavier7/react-three-fiber#274---encoding)
        5. [Pixel Ratio](https://github.com/ivanxavier7/react-three-fiber#275---pixel-ratio)


3. [Drei](https://github.com/ivanxavier7/react-three-fiber#3---drei)
    1. [Setup](https://github.com/ivanxavier7/react-three-fiber#31---setup)
    2. [Camera Controls](https://github.com/ivanxavier7/react-three-fiber#32---camera-controls)
    3. [Geometries](https://github.com/ivanxavier7/react-three-fiber#33---geometries)

        1. [Transform Controls](https://github.com/ivanxavier7/react-three-fiber#331---transform-controls)
        2. [Pivot Controls](https://github.com/ivanxavier7/react-three-fiber#332---pivot-controls)

    4. [HTML](https://github.com/ivanxavier7/react-three-fiber#34---html)
    5. [3D Text](https://github.com/ivanxavier7/react-three-fiber#35---3d-text)
    6. [Float animation](https://github.com/ivanxavier7/react-three-fiber#36---float-animation)
    7. [Materials](https://github.com/ivanxavier7/react-three-fiber#37---materials)


4. [Debug](https://github.com/ivanxavier7/react-three-fiber#4---debug)
    1. [StrictMode](https://github.com/ivanxavier7/react-three-fiber#41---strictmode)
    2. [Leva](https://github.com/ivanxavier7/react-three-fiber#42---leva)
    3. [Monitoring](https://github.com/ivanxavier7/react-three-fiber#43---monitoring)


5. [Environment and Staging](https://github.com/ivanxavier7/react-three-fiber#5---environment-and-staging)
    1. [Background Color](https://github.com/ivanxavier7/react-three-fiber#51---background-color)

        1. [CSS](https://github.com/ivanxavier7/react-three-fiber#51---background-color)
        2. [Javascript](https://github.com/ivanxavier7/react-three-fiber#512---javascript)
        3. [Three.js](https://github.com/ivanxavier7/react-three-fiber#513---threejs)
        4. [React Three Fiber](https://github.com/ivanxavier7/react-three-fiber#514---react-three-fiber)

    2. [Lights](https://github.com/ivanxavier7/react-three-fiber#52---lights)
        1. [Light Helpers](https://github.com/ivanxavier7/react-three-fiber#521-light-helpers)
        2. [Types of lights](https://github.com/ivanxavier7/react-three-fiber#522-types-of-lights)

            1. [Sharp shadows](https://github.com/ivanxavier7/react-three-fiber#5331---sharp-shadows)
            2. [Soft shadows](https://github.com/ivanxavier7/react-three-fiber#5332---soft-shadows)
            3. [Accumulative shadows](https://github.com/ivanxavier7/react-three-fiber#5333---accumulative-shadows)
            4. [Contact shadows](https://github.com/ivanxavier7/react-three-fiber#5334---contact-shadows)

    3. [Shadows](https://github.com/ivanxavier7/react-three-fiber#53---shadows)

        1. [Setup](https://github.com/ivanxavier7/react-three-fiber#531---setup)
        2. [Baking](https://github.com/ivanxavier7/react-three-fiber#532---baking)
        3. [Configure](https://github.com/ivanxavier7/react-three-fiber#533---configure)

    4. [Sky](https://github.com/ivanxavier7/react-three-fiber#54---sky)
    5. [Environments map](https://github.com/ivanxavier7/react-three-fiber#55---environments-map)

        1. [Cube Map](https://github.com/ivanxavier7/react-three-fiber#551---cube-map)
        2. [HDR Map](https://github.com/ivanxavier7/react-three-fiber#552---hdr-map)
        3. [Preset](https://github.com/ivanxavier7/react-three-fiber#553---preset)
        4. [Custom](https://github.com/ivanxavier7/react-three-fiber#554---custom)
        5. [Custom Lights](https://github.com/ivanxavier7/react-three-fiber#555-custom-lights)

    6. [Stage](https://github.com/ivanxavier7/react-three-fiber#56---stage)

        1. [Loader and Draco](https://github.com/ivanxavier7/react-three-fiber#61---loader-and-draco)
        2. [Loading Bigger Models](https://github.com/ivanxavier7/react-three-fiber#62---loading-bigger-models)
        3. [Drei](https://github.com/ivanxavier7/react-three-fiber#63---drei)
        4. [Multiple instances](https://github.com/ivanxavier7/react-three-fiber#64---multiple-instances)
        5. [GLTF to Component](https://github.com/ivanxavier7/react-three-fiber#65---gltf-component)
        6. [Animations](https://github.com/ivanxavier7/react-three-fiber#66---animations)



6. [Load Models](https://github.com/ivanxavier7/react-three-fiber#6---load-models)

    1. [Loader and Draco](https://github.com/ivanxavier7/react-three-fiber#61---loader-and-draco)
    2. [Loading Bigger Models](https://github.com/ivanxavier7/react-three-fiber#62---loading-bigger-models)

        1. [Loading](https://github.com/ivanxavier7/react-three-fiber#631---loading)
        2. [Preloading](https://github.com/ivanxavier7/react-three-fiber#632---preloading)

    3. [Drei](https://github.com/ivanxavier7/react-three-fiber#63---drei)
    4. [Multiple instances](https://github.com/ivanxavier7/react-three-fiber#64---multiple-instances)
    5. [GLTF to Component](https://github.com/ivanxavier7/react-three-fiber#65---gltf-component)

        1. [Convert](https://github.com/ivanxavier7/react-three-fiber#651---convert)
        2. [Import and Shadow Acne](https://github.com/ivanxavier7/react-three-fiber#652---import-and-shadow-acne)

    6. [Animations](https://github.com/ivanxavier7/react-three-fiber#66---animations)

        1. [Load](https://github.com/ivanxavier7/react-three-fiber#661---load)
        2. [Transitions](https://github.com/ivanxavier7/react-three-fiber#662---transitions)
        3. [Control with GUI / Leva](https://github.com/ivanxavier7/react-three-fiber#663---control-with-gui--leva)



7. [3D Text](https://github.com/ivanxavier7/react-three-fiber#7---3d-text)

    1. [Setup](https://github.com/ivanxavier7/react-three-fiber#71---setup)

        1. [Text Parameters](https://github.com/ivanxavier7/react-three-fiber#711-text-parameters)
        2. [Matcap](https://github.com/ivanxavier7/react-three-fiber#712-matcap)

    2. [Particles](https://github.com/ivanxavier7/react-three-fiber#72---particles)

        1. [React Fiber](https://github.com/ivanxavier7/react-three-fiber#721---react-fiber)
        2. [Three.js](https://github.com/ivanxavier7/react-three-fiber#722---threejs)

    3. [Animate](https://github.com/ivanxavier7/react-three-fiber#73----animate)

        1. [Group](https://github.com/ivanxavier7/react-three-fiber#731---group)
        2. [Array](https://github.com/ivanxavier7/react-three-fiber#732---array)



8. [Baked Models and Shaders](https://github.com/ivanxavier7/react-three-fiber#8---baked-models-and-shaders)

    1. [Loading Baked Models](https://github.com/ivanxavier7/react-three-fiber#81---loading-baked-models)
    2. [Drei Particles](https://github.com/ivanxavier7/react-three-fiber#82---drei-particles)
    3. [Shader Materials](https://github.com/ivanxavier7/react-three-fiber#83---shader-materials)


9. [Mouse Events and Raycasting](https://github.com/ivanxavier7/react-three-fiber#9---mouse-events-and-raycasting)

    1. [Event Example](https://github.com/ivanxavier7/react-three-fiber#91---event-example)
    2. [Event Information](https://github.com/ivanxavier7/react-three-fiber#92---event-information)
    3. [Types of Events](https://github.com/ivanxavier7/react-three-fiber#93---types-of-events)

        1. [Click](https://github.com/ivanxavier7/react-three-fiber#931---click)
        2. [Right Click](https://github.com/ivanxavier7/react-three-fiber#932---right-click)
        3. [Double Click](https://github.com/ivanxavier7/react-three-fiber#933---double-click)
        4. [Pointer Up](https://github.com/ivanxavier7/react-three-fiber#934---pointer-up)
        5. [Pointer Down](https://github.com/ivanxavier7/react-three-fiber#935---pointer-down)
        6. [Pointer Over](https://github.com/ivanxavier7/react-three-fiber#936---pointer-over)
        7. [Pointer Enter](https://github.com/ivanxavier7/react-three-fiber#937---pointer-enter)
        8. [Pointer Out](https://github.com/ivanxavier7/react-three-fiber#938---pointer-out)
        9. [Pointer Leave](https://github.com/ivanxavier7/react-three-fiber#939---pointer-leave)
        10. [Pointer Move](https://github.com/ivanxavier7/react-three-fiber#9310---pointer-move)
        11. [Pointer Miss](https://github.com/ivanxavier7/react-three-fiber#9311---pointer-miss)

    4. [Applications](https://github.com/ivanxavier7/react-three-fiber#94---applications)
    5. [Occluding / Block Ray](https://github.com/ivanxavier7/react-three-fiber#95---occlusion--block-ray)
    6. [Cursor](https://github.com/ivanxavier7/react-three-fiber#96---cursor)

        1. [Pointer / Finger](https://github.com/ivanxavier7/react-three-fiber#961---pointer--finger)
        2. [Drei Helper - Recommended](https://github.com/ivanxavier7/react-three-fiber#962---drei-helper---recommended)

    7. [Model Events](https://github.com/ivanxavier7/react-three-fiber#97---model-events)
    8. [Performance](https://github.com/ivanxavier7/react-three-fiber#98---performance)

        1. [Mesh Bounds / Geometries](https://github.com/ivanxavier7/react-three-fiber#981---mesh-bounds--geometries)
        2. [BVH](https://github.com/ivanxavier7/react-three-fiber#982---bvh--models-or-scene)

10. [Post-processing]()


11. [Physics]()


12. [Projects]()



------

# 1 - React

[React Docs](https://react.dev/learn)
[React Courses](https://legacy.reactjs.org/community/courses.html)

1. [Setup](https://github.com/ivanxavier7/react-three-fiber#11---setup)
2. [JSX](https://github.com/ivanxavier7/react-three-fiber#12---event-reacting)
3. [Conditional rendering](https://github.com/ivanxavier7/react-three-fiber#13---conditional-rendering)
4. [Properties](https://github.com/ivanxavier7/react-three-fiber#14---properties)
5. [Mapping cycle](https://github.com/ivanxavier7/react-three-fiber#15---mapping-cycle)
6. [Cache](https://github.com/ivanxavier7/react-three-fiber#16---cache)
7. [DOM](https://github.com/ivanxavier7/react-three-fiber#17---dom)
8. [People component](https://github.com/ivanxavier7/react-three-fiber#18---people-component)
9. [Fetch API](https://github.com/ivanxavier7/react-three-fiber#19---fetch-api)

## 1.1 - Setup

1. [NPX-Node](https://github.com/ivanxavier7/react-three-fiber#111---npx)
2. [Scratch](https://github.com/ivanxavier7/react-three-fiber#112---scratch)
3. [Vite - Recommended](https://github.com/ivanxavier7/react-three-fiber#113---vite)

### 1.1.1 - NPX 

* Needs `npm` to get dependencies, ideal to modular applications

[Create React App - NPX](https://www.npmjs.com/package/create-react-app)

Istall project
``` bash
npm install -g npx # Install npx globally
npx create-react-app .
```

### 1.1.2 - Scratch

* NPX adds unecessary files so we can do it from scratch

1. Initialize
``` bash
npm init -y
```

2.  Add dependencies
``` bash
npm install react@18 react-dom@18.2 react-scripts@5.0
```
3. Change `package.json`
``` json
{
    // ...
  "scripts": {
    "dev": "react-scripts start",
    "build": "react-scripts build"
  },
    // ...
}
```

4. Create `/public/` folder

5. Create `index.html` inside `/public/` folder, and use `!` or `html:5` to generate the code.

6. Add `root` to the body
``` html
<body>
    <div id="root"></div>
</body>
```

7. Add `/src/` folder

8. Add inside `/src/` folder the `index.js`

``` javascript
import { createRoot } from 'react-dom/client'

const root = createRoot(document.querySelector('#root'))

root.render(
    <h1>Hellor React</h1>
)
```

9. Run the server
``` bash
npm run dev
```

10. Choose yes to add default browser configurations


### 1.1.3 - Vite

1. Create Vite project

``` bash
npm create vite@latest
```

2. Choose project name

3. Choose React framework

4. Choose JavaScript Template

5. Enter the project folder and install
``` bash
npm install
```

6. Run
``` bash
npm run dev
```

7. Install react scripts (optional)
``` bash
npm install react-scripts --save
```

------

## 1.2 - Event Reacting

`useState`

* Generates a variable linked to a function varname and setVarname(), this makes the site react to changes in this variable

`useEffect`

* Triggers a function when a variable changes

``` javascript
import { useState, useEffect } from 'react'


export default function Clicker()
{
    const [ count, setCount ] = useState(parseInt(localStorage.getItem('count') ?? 0))  // Save value locally

    useEffect(() => {
        localStorage.setItem('count', count) 
    }, [ count ])

    let buttonClick = () =>
    {
        setCount(count + 1)
    }

    return (
      <>
        <div> Click count: { count } </div>
        <button onClick={ buttonClick }>Click me</button>
      </>
    )
}
```

When we leave the array empty `[]` in the `useEffect`, we can the hook the component itself

``` javascript
useEffect(() => {
    console.log('first render of the clicker')
    return () =>
    {
    console.log('disposing clicker component')
    localStorage.removeItem('count')
    }
}, [])  
```

## 1.3 - Conditional rendering

Rendering components conditionally, in the example we use a button that toggle click component

``` javascript
import { useState } from "react"
import Clicker from "./Clicker"

export default function App()
{
    const [ hasClicker, setHasClicker ] = useState(true)

    const toggleClickerClick = () =>
    {
        setHasClicker(!hasClicker)
    }

    return <>
        <button onClick={toggleClickerClick}>{hasClicker ? 'Hide' : 'Show'} Toggle click </button>
        {/* hasClicker ? <Clicker /> : null*/}
        { hasClicker && <Clicker /> }
    </>
}
```

------

## 1.4 - Properties

Multiple `Clickers` using the same local storage variable, when we update the page the last value to be updated will be shared by the other `Clickers`, we can catch the content inside one component with the `{ children }` property

Click with property to fix the problem

`App.jsx`

``` javascript	
<Clicker keyName={'countA'}/>
<Clicker keyName={'countB'}/>
<Clicker keyName={'countC'}/>
```

`Clicker.jsx`

``` javascript
export default function Clicker({keyName})
{
    const [ count, setCount ] = useState(parseInt(localStorage.getItem(keyName) ?? 0))

    useEffect(() => {
      return () =>
      {
        localStorage.removeItem(keyName)
      }
    }, [])  

    useEffect(() => {
        localStorage.setItem(keyName, count) 
    }, [ count ])   
    // (...)
}
```

-------

## 1.5 - Mapping cycle

We can use the `map()` function to cycle through functions through each element of an array and use its index

``` javascript
const tempArray = [...Array(clickersCount)] // Spread operator, converts null in undefined, fills the array
console.log(tempArray)
// Now we can loop 4 times
// Map go though each item on the array and call a function on it
tempArray.map((value, index) =>{
    console.log(value, index)
})
```

### Implementation

`index.jsx`
``` javascript
<App clickersCount={ 3 } />
```

`App.jsx`
``` javascript
{ [...Array(clickersCount)].map((value, index) => 
    <Clicker
        key={index}
        increment={ increment }
        keyName={`count${index}`}
        color={`hsl(${ Math.random() * 360 }deg, 100%, 70%)`}
    />
)}
```

------

## 1.6 - Cache

When we need to use the cache to store some information we must use `useMemo`

``` javascript
import { useState, useMemo } from "react"

const colors = useMemo(() => {
    const colors = []

    for(let i=0; i<clickersCount; i++)
        colors.push(`hsl(${ Math.random() * 360 }deg, 100%, 75%)`)

    return colors
}, [])

<Clicker
    color={colors[index]}
/>
```

------

## 1.7 - DOM

To access the component itself, we should use `useRef`

``` javascript
import { useRef, useEffect } from 'react'

const buttonRef = useRef()

// first render
useEffect(() => {
    // DOM
    buttonRef.current.style.backgroundColor = 'cyan'
    buttonRef.current.style.color = 'red'

    return () =>
    {
    }
}, []) 

<button
    ref={ buttonRef }
</button>
```

------

## 1.8 - People component

Basic example of a component with a list of objects and showing them in a list

``` javascript
import { useState } from 'react'

export default function People()
{
    const [ people, setPeople ] =useState([
        { id: 1, name: 'Ivan'},
        { id: 2, name: 'Xavier'},
        { id: 3, name: 'Jo√£o'},
        { id: 4, name: 'Ana'},
        { id: 5, name: 'Maria'},
    ])

    return <div>
        <h2>People</h2>

        <ul>
        { people.map(person => <li key={ person.id }>{ person.name }</li>) }
        </ul>
    </div>
}
```

## 1.9 - Fetch API

Using the same example as the previous component, we can see an example of a request to an API and the application of its data in the component

[API example](https://jsonplaceholder.typicode.com/)

``` javascript
import { useState, useEffect } from 'react'

export default function People()
{
    const [ people, setPeople ] =useState([
        { id: 1, name: 'Ivan'},
        { id: 2, name: 'Xavier'},
        { id: 3, name: 'Jo√£o'},
        { id: 4, name: 'Ana'},
        { id: 5, name: 'Maria'},
    ])

    const getPeople = async () =>
    {
        const response = await fetch('https://jsonplaceholder.typicode.com/users')
        const result = await response.json()
        setPeople(result)
    }

    useEffect(() => 
    {
        getPeople() // When the component is created, fetch all the people
    }, [])

    return <div>
        <h2>People</h2>

        <ul>
        { people.map(person => <li key={ person.id }>{ person.name }</li>) }
        </ul>
    </div>
}
```

------

# 2 - R3F Simple Application

* [React Three Fiber  Docs](https://docs.pmnd.rs/react-three-fiber/getting-started/introduction)

* [React Three Fiber Tutorials](https://sbcode.net/react-three-fiber/)

* [Performance tips](https://docs.pmnd.rs/react-three-fiber/advanced/scaling-performance#instancing)

1. [Setup](https://github.com/ivanxavier7/react-three-fiber#21---setup)
2. [Implementation](https://github.com/ivanxavier7/react-three-fiber#22---implementation)
3. [Animate](https://github.com/ivanxavier7/react-three-fiber#23---animate)
4. [OrbitControls](https://github.com/ivanxavier7/react-three-fiber#24---orbitcontrols)
5. [Lights](https://github.com/ivanxavier7/react-three-fiber#25---lights)
6. [Custom Geometry](https://github.com/ivanxavier7/react-three-fiber#26---custom-geometry)
7. [Canvas](https://github.com/ivanxavier7/react-three-fiber#27---canvas)

## 2.1 - Setup

``` bash
npm install three@0.153 @react-three/fiber@8.13 --save
```

## 2.2 - Implementation

```javascript
import { Canvas } from '@react-three/fiber'

<Canvas>
    <group>
        <mesh position-x={ -2 }>
            <sphereGeometry  />
            <meshBasicMaterial color={ 'orange' }/>
        </mesh>
        <mesh
            position-x={ 2 }
            rotation-y={ Math.PI * 0.25 }
            scale={ 1.5 }
        >
            <boxGeometry />
            <meshBasicMaterial color={ 'mediumPurple' }  />
        </mesh>
        <mesh
            position-y={ -1 }
            rotation-x={ Math.PI * - 0.5 }
            scale={ 10 }
        >
            <planeGeometry />
            <meshBasicMaterial color={ 'DarkGreen' }  />
        </mesh>
    </group>
</Canvas>
```

## 2.3 - Animate

we must use the delta to synchronize with the frames of each device, for example, a 144hz screen will animate differently if we do not use the delta

``` javascript
import { useFrame } from '@react-three/fiber'
import { useRef } from 'react'

export default function Experience ()
{
    const cubeRef = useRef()
    useFrame((state, delta) =>
    {
        cubeRef.current.rotation.y += delta
    })

    return <>
        <mesh
            ref={ cubeRef }
        >
            <boxGeometry />
            <meshBasicMaterial />
        </mesh>
    </>
}
```

## 2.4 - OrbitControls

Add orbital controls to the camera

``` javascript
import { useThree ,extend, useFrame } from '@react-three/fiber'

export default function Experience ()
{
    const {camera, gl } = useThree()

    return <>
        <orbitControls args={[ camera, gl.domElement]}/>
        <mesh>
            <boxGeometry />
            <meshBasicMaterial color={ 'mediumPurple' }  />
        </mesh>
    </>
}
```

## 2.5 - Lights

``` javascript
<directionalLight position={[0,2,2]} intensity={ 1.5 } color={ 'Aquamarine' }/>
<ambientLight intensity={ 0.3 } color={'blue'}/>
```

## 2.6 - Custom Geometry

1. Create `Float32Array` for the coordinates
2. Fill the array with values
3. Save it in the cache
4. Create BufferAttribute with this array
5. Add the BufferAttribute to the BuggerGeometry
6. Set the normals in the object

``` javascript
import * as THREE from 'three'
import { useEffect ,useRef, useMemo } from 'react'

export default function CustomObject()
{
    const geometryRef = useRef()
    
    const verticesCount = 10 * 3

    const positions = useMemo(() =>
    {
        const positions = new Float32Array(verticesCount * 3)

        for(let i = 0; i < verticesCount * 3; i++)
        {
            positions[i] = (Math.random() - 0.5) * 3
        }

        return positions
    }, [])

    useEffect(() =>
    {
        //console.log(geometryRef.current)
        geometryRef.current.computeVertexNormals()
    }, [])

    return <mesh>
        <bufferGeometry
            ref={ geometryRef }
        >
            <bufferAttribute 
                attach="attributes-position"
                count={ verticesCount }
                itemSize={ 3 }
                array={ positions}
                
            />
        </bufferGeometry>
        <meshStandardMaterial color="red" side={ THREE.DoubleSide }/>
    </mesh>
}
```

## 2.7 - Canvas

1. [Animating Camera](https://github.com/ivanxavier7/react-three-fiber#271---animating-camera)
2. [Antialias](https://github.com/ivanxavier7/react-three-fiber#272---antialias)
3. [ToneMapping](https://github.com/ivanxavier7/react-three-fiber#273---tonemapping)
4. [Encoding](https://github.com/ivanxavier7/react-three-fiber#274---encoding)
5. [Pixel Ratio](https://github.com/ivanxavier7/react-three-fiber#275---pixel-ratio)

The canvas configures the following for us:
* `Scene`
* `Camera`
* `Renderer`
* `Antialias`
* `Encoding`
* `etc`

But these parameters may have to be modified by us

``` javascript
<Canvas 
    camera={ {  
    position: [1, 2, 3],
    fov: 45,
    near: 0.1,
    far: 200
    }}
>
    <Experience />
    <CustomObject />
</Canvas>
```

### 2.7.1 - Animating Camera

Make the camera move in circles around the scene, while looking at its center

``` javascript
useFrame((state, delta) =>
{
    const angle = state.clock.elapsedTime
    state.camera.position.x = Math.sin(angle)
    state.camera.position.z = Math.cos(angle)
    state.camera.lookAt(0, 0, 0)
})
```

### 2.7.2 - Antialias

Is enabled by default, we can remove it with:
``` javascript
<Canvas
    gl={ {
    antialias: false
    }} 
>
    <CustomObject />
</Canvas>
```

### 2.7.3 - ToneMapping

The default is the ACESFilmicToneMapping

we can remove it adding `flat` to the canvas.

``` javascript
<Canvas
    flat
>
    <CustomObject />
</Canvas>
```

Or choose your ToneMapping

``` javascript
import * as THREE from 'three'

<Canvas
    gl={ {
    toneMapping: THREE.CineonToneMapping
    }} 

>
    <CustomObject />
</Canvas>
```

### 2.7.4 - Encoding

By default is set to sRGBEncoding, we can change with `gl` property

``` javascript
import * as THREE from 'three'

<Canvas
    gl={ {
    outputEncoding: THREE.LinearSRGBColorSpace
    }} 
>
    <CustomObject />
</Canvas>
```

### 2.7.5 - Pixel Ratio

We can force a specific pixel ratio with the attribute `dpr`, if its below 1, gets 1, if its above 2 will become 2.
The default is 1 to 2, so we can remove this.

``` javascript
<Canvas
    dpr={ 1, 2 }
>
    <CustomObject />
</Canvas>
```

-------

## 3 - Drei

* [Drei Documentation](https://github.com/pmndrs/drei)
* [Drei Examples](https://drei.pmnd.rs/?path=/docs/staging-environment--docs)

Examples of some helpers using `Drei`

1. [Setup](https://github.com/ivanxavier7/react-three-fiber#31---setup)
2. [Camera Controls](https://github.com/ivanxavier7/react-three-fiber#32---camera-controls)
3. [Geometries](https://github.com/ivanxavier7/react-three-fiber#33---geometries)
4. [HTML](https://github.com/ivanxavier7/react-three-fiber#34---html)
5. [3D Text](https://github.com/ivanxavier7/react-three-fiber#35---3d-text)
6. [Float animation](https://github.com/ivanxavier7/react-three-fiber#36---float-animation)
7. [Materials](https://github.com/ivanxavier7/react-three-fiber#37---materials)


## 3.1 - Setup


``` bash
npm install @react-three/drei@9.77
```

## 3.2 - Camera Controls

Orbit Controls

``` javascript
import { OrbitControls } from '@react-three/drei'

export default function Experience()
{
    return <>
        <OrbitControls />
        {/* ... */}
    </>
}
```

## 3.3 - Geometries

1. [Transform Controls](https://github.com/ivanxavier7/react-three-fiber#331---transform-controls)
2. [Pivot Controls](https://github.com/ivanxavier7/react-three-fiber#332---pivot-controls)

### 3.3.1 - Transform Controls

Change the `Position`, `Rotation` and `Scale` of the object

``` javascript
import { TransformControls, OrbitControls } from '@react-three/drei'

export default function Experience()
{
    return <>
        <OrbitControls makeDefault/>
        <TransformControls position={ [ 1, 2, 3 ] }> 
            <directionalLight position={ [ 1, 2, 3 ] } intensity={ 1.5 } />
        </TransformControls>
        {/* ... */}
    </>
}
```

Or with `hooks`

``` javascript
import { TransformControls, OrbitControls } from '@react-three/drei'
import { useRef } from 'react'

export default function Experience()
{
    return <>
        <OrbitControls makeDefault/>
        <directionalLight ref={ cube} position={ [ 1, 2, 3 ] } intensity={ 1.5 } />
        <TransformControls object={ cube } mode="rotate"/>
        {/* <TransformControls object={ cube } mode="rotate"/> */}
        {/* <TransformControls object={ cube } mode="scale"/> */}
        {/* ... */}
    </>
}
```

### 3.3.2 - Pivot Controls

Can rotate, move in Axis or by faces on a relative point of referent.

``` javascript
import { PivotControls, OrbitControls } from '@react-three/drei'

<PivotControls
    anchor={ [0, 0, 0] }
    depthTest={ false}
    lineWidth={ 4 }
    axisColors={ ['#8978fb','#16afb4', '#7ba371'] }
    scale={ 2 }
>
    <mesh position-x={ 2 } scale={ 1.5 } >
        <boxGeometry />
        <meshStandardMaterial color="mediumpurple" />
    </mesh>
</PivotControls>
```

## 3.4 - HTML

DOM element that stick to the object

``` javascript
import { Html } from '@react-three/drei'

<mesh ref={ cube } position-x={ 2 } scale={ 1.5 } >
    <boxGeometry />
    <meshStandardMaterial color="mediumpurple" />
    <Html
        position={ [-1, 1, 0 ] }
        wrapperClass='label'
        distanceFactor={ 8 }
        occlude={ [ sphere, cube ] }
    >
        That's a cube üëå‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è
    </Html>
</mesh>
```

``` css
.label > div
{
    font-family: Helvetiva, Arial;
    position: absolute;
    background: #00000088;
    color: white;
    padding: 15px;
    white-space: nowrap;
    overflow: hidden;
    border-radius: 30px;
    user-select: none;
}
```

## 3.5 - 3D Text

`SDF Fonts` Signed Distance Field Fonts - Shader functions for the text

Patters
* [2D SDF Functions](https://iquilezles.org/articles/distfunctions2d/)
* [#D SDF Functions](https://iquilezles.org/articles/distfunctions/)

Fonts
* [Google FOnts](https://fonts.google.com/)

Formats supporter:

* `woff` - lighter
* `ttf`
* `otf`

``` javascript
import { Text } from '@react-three/drei'

<Text
    font="./bangers-v20-latin-regular.woff"
    fontSize= { 0.5 }
    color="DarkCyan"
    position={ [-1, 2, 1] }
    scale={ 2 }
    maxWidth={ 1.5 }
    textAlign='center'
>
    Ivan Xavier
    <meshNormalMaterial />
</Text>
```

## 3.6 - Float animation

``` javascript
import { Float, Text } from '@react-three/drei'

<Float
    speed={ 5 }
    floatIntensity={ 3 }
    rotationIntensity={ 2 }
>
    <Text
        font="./bangers-v20-latin-regular.woff"
        fontSize= { 0.5 }
        color="DarkCyan"
        position={ [-1, 2, 1] }
        scale={ 2 }
        maxWidth={ 1.5 }
        textAlign='center'
    >
        Ivan Xavier
        <meshNormalMaterial />
    </Text>
</Float>
```

## 3.7 - Materials

Using a `MeshReflectorMaterial` on the floor to reflect the objects

``` javascript
import { MeshReflectorMaterial } from '@react-three/drei'

<mesh position-y={ - 1 } rotation-x={ - Math.PI * 0.5 } scale={ 10 }>
    <planeGeometry />
    <MeshReflectorMaterial color="darkgreen" />
</mesh>
```

------


## 4 - Debug

Use React Developer Tools extension for the browser.

1. [StrictMode](https://github.com/ivanxavier7/react-three-fiber#41---strictmode)
2. [Leva](https://github.com/ivanxavier7/react-three-fiber#42---leva)
3. [Monitoring](https://github.com/ivanxavier7/react-three-fiber#43---monitoring)

## 4.1 - StrictMode

Warn about some problems:

* Infinite render loop
* Forgotten useEffect dependencies
* Unused imports
* Deprecated pratices

``` javascript
import { StrictMode } from 'react'

const root = ReactDOM.createRoot(document.querySelector('#root'))

root.render(
    <StrictMode>
        <Canvas
            camera={ {
                fov: 45,
                near: 0.1,
                far: 200,
                position: [ - 4, 3, 6 ]
            } }
        >
            <Experience />
        </Canvas>
    </StrictMode>
)
```

## 4.2 - Leva

* [Leva Documentation](https://github.com/pmndrs/leva)
* [Leva Configuration](https://github.com/pmndrs/leva/blob/main/docs/configuration.md)

``` bash
npm install leva@0.9
```

## 4.3 - Monitoring

* [R3F-Perf Docs](https://github.com/utsuboco/r3f-perf)

`r3f-perf` Monitors resource consumption on the graphics card, processor, counts FPS, calls and total triangles

``` bash
npm install r3f-perf@7.1
```

``` javascript
import { Perf } from 'r3f-perf'

<Perf
    position="top-left"
/>
```

------

## 5 - Environment and Staging

1. [Background Color](https://github.com/ivanxavier7/react-three-fiber#51---background-color)
2. [Lights](https://github.com/ivanxavier7/react-three-fiber#52---lights)
3. [Shadows](https://github.com/ivanxavier7/react-three-fiber#53---shadows)
4. [Sky](https://github.com/ivanxavier7/react-three-fiber#54---sky)
5. [Environments map](https://github.com/ivanxavier7/react-three-fiber#55---environments-map)
6. [Stage](https://github.com/ivanxavier7/react-three-fiber#56---stage)


## 5.1 - Background Color

1. [CSS](https://github.com/ivanxavier7/react-three-fiber#51---background-color)
2. [Javascript](https://github.com/ivanxavier7/react-three-fiber#512---javascript)
3. [Three.js](https://github.com/ivanxavier7/react-three-fiber#513---threejs)
4. [React Three Fiber](https://github.com/ivanxavier7/react-three-fiber#514---react-three-fiber)


### 5.1.1 - CSS
``` css
#root
{
    background-color: black;
}
```


### 5.1.2 - Javascript
`index.jsx`
``` javascript
const created = ({ gl }) =>
{
    gl.setClearColor('#ff0000', 1)
}
```


### 5.1.3 - Three.js
``` javascript
import * as THREE from 'three'

const created = ({ scene }) =>
{
    scene.background = new THREE.Color('#00ff00')
}
```


### 5.1.4 - React Three Fiber
``` javascript
<Canvas>
    <color args={ [ '#0000ff' ] }  attach="background"/>
</Canvas>
```


## 5.2 - Lights

1. [Light Helpers](https://github.com/ivanxavier7/react-three-fiber#521-light-helpers)
2. [Types of lights](https://github.com/ivanxavier7/react-three-fiber#522-types-of-lights)


### 5.2.1. Light Helpers

This can be used with the camera

``` javascript
import { useHelper, OrbitControls } from '@react-three/drei'
import * as THREE from 'three'
import { useRef } from 'react'

const directionalLight = useRef()
useHelper(directionalLight, THREE.DirectionalLightHelper, 1)

<directionalLight
    ref={ directionalLight }
    position={ [ 1, 2, 3 ] }
    intensity={ 1.5 }
/>
```


### 5.2.2. Types of lights

1. `<ambientLight />`
2. `<hemisphereLight />`
3. `<directionalLight />`
4. `<pointLightLight />`
5. `<rectAreaLightLight />`
6. `<spotLightLight />`


## 5.3 - Shadows

Realistic shadows have slightly bluer pigmentation, change the color accordingly

1. [Setup](https://github.com/ivanxavier7/react-three-fiber#531---setup)
2. [Baking](https://github.com/ivanxavier7/react-three-fiber#532---baking)
3. [Configure](https://github.com/ivanxavier7/react-three-fiber#533---configure)

### 5.3.1 - Setup

`index.jsx`
``` javascript
    <Canvas
        shadows
    >
    </Canvas>
```

`component.jsx`
``` javascript
<directionalLight
    castShadow
/>

<mesh
    castShadow
>
    <sphereGeometry />
    <meshStandardMaterial />
</mesh>

<mesh
    castShadow
>
    <boxGeometry />
    <meshStandardMaterial />
</mesh>

<mesh
    receiveShadow
>
    <planeGeometry />
    <meshStandardMaterial />
</mesh>
```

### 5.3.2 - Baking

For static shadows, reduce resources needed to cast a shadow.

``` javascript
import { BakeShadows } from '@react-three/drei'

<BakeShadows />
```

### 5.3.3 - Configure

1. [Sharp shadows](https://github.com/ivanxavier7/react-three-fiber#5331---sharp-shadows)
2. [Soft shadows](https://github.com/ivanxavier7/react-three-fiber#5332---soft-shadows)
3. [Accumulative shadows](https://github.com/ivanxavier7/react-three-fiber#5333---accumulative-shadows)
4. [Contact shadows](https://github.com/ivanxavier7/react-three-fiber#5334---contact-shadows)

#### 5.3.3.1 - Sharp shadows

``` javascript
<directionalLight
    ref={ directionalLight }
    position={ [ 1, 2, 3 ] }
    intensity={ 1.5 }
    castShadow
    shadow-mapSize={ [ 1024, 1024 ] }
    shadow-camera-near={ 1 }
    shadow-camera-far={ 10 }
    shadow-camera-top={ 5 }
    shadow-camera-right={ 5 }
    shadow-camera-bottom={ -5 }
    shadow-camera-left={ -5 }
/>
```


#### 5.3.3.2 - Soft shadows

Softens the shadow depending on the distance from the object.

``` javascript
import { SoftShadows } from '@react-three/drei'

<SoftShadows
    size={ 25 }
    samples={ 10 }
    focus={ 0 }
/>
```


#### 5.3.3.3 - Accumulative shadows

Accumulates multiple shadows, moves the light randomly before each render and compose them together, can be used only with a `Plane`, ideal to make a floor.

Final accumulation will create delay in shadow calculation, not ideal for animating

``` javascript
import { AccumulativeShadows, RandomizedLight } from '@react-three/drei'

<AccumulativeShadows
    position={ [0, -0.99, 0 ] }
    scale={ 10 }
    color='#326447'
    opacity={ 0.8 }
    frames={ Infinity }
    temporal
    blend={ 100 }
>
    <RandomizedLight
        amount={ 8 }
        radius={ 1 }
        ambient={ 0.5 }
        bias={ 0.001 }
        position={ [1, 2, 3] }
        castShadow
    />
</AccumulativeShadows>
```


#### 5.3.3.4 - Contact shadows

Don't use default shadows, we can deactivate them, don¬¥t need a light and only works on a plane

Render from the floor, and use the `frames={ 1 } to bake the shadow`, the light comes always from the front of the plane and its good for performance.

`index.jsx`
``` javascript
<Canvas
    shadows={ false }
>
</Canvas>
```

`component.jsx`
``` javascript
import { useControls } from 'leva'
import { ContactShadows } from '@react-three/drei'

<ContactShadows
    position={ [ 0, -0.99, 0] }
    scale={ 10 }
    resolution={ 512 }
    far={ 5 }
    near={ 0.01 }
    color={ color }
    opacity={ opacity }
    blur={ blur }
    frames={ 1 }
/>
```


## 5.4 - Sky

Creates a sky that can be customized, to improve the sun, we associate a directional light to update the shadows on objects in relation to the position of the sun.

``` javascript
import { Sky } from '@react-three/drei'
import { useControls } from 'leva'


const { sunPosition } = useControls('sky',
{
    sunPosition: { value: [ 1, 2, 3] }
})

<directionalLight
    ref={ directionalLight }
    position={ sunPosition }
    intensity={ 1.5 }
    castShadow
    shadow-mapSize={ [ 1024, 1024 ] }
    shadow-camera-near={ 1 }
    shadow-camera-far={ 10 }
    shadow-camera-top={ 5 }
    shadow-camera-right={ 5 }
    shadow-camera-bottom={ -5 }
    shadow-camera-left={ -5 }
/>

<Sky
    position={ sunPosition }
/>
```


## 5.5 - Environments map

1. [Cube Map](https://github.com/ivanxavier7/react-three-fiber#551---cube-map)
2. [HDR Map](https://github.com/ivanxavier7/react-three-fiber#552---hdr-map)
3. [Preset](https://github.com/ivanxavier7/react-three-fiber#553---preset)
4. [Custom](https://github.com/ivanxavier7/react-three-fiber#554---custom)
5. [Custom Lights](https://github.com/ivanxavier7/react-three-fiber#555-custom-lights)


### 5.5.1 - Cube Map

Load the textures and apply them to all materials

``` javascript
import { Environment } from '@react-three/drei'
import { useControls } from 'leva'

const { envMapIntensity } = useControls('environment map',
{
    envMapIntensity: { value: 3.5, min: 0, max: 12 }
})

<Environment
    background
    files={ [
        './environmentMaps/0/px.jpg',
        './environmentMaps/0/nx.jpg',
        './environmentMaps/0/py.jpg',
        './environmentMaps/0/ny.jpg',
        './environmentMaps/0/pz.jpg',
        './environmentMaps/0/nz.jpg',
    ] }
/>

<mesh
    castShadow
>
    <boxGeometry />
    <meshStandardMaterial
        envMapIntensity={ envMapIntensity }
    />
</mesh>

<mesh>
    <planeGeometry />
    <meshStandardMaterial
        envMapIntensity={ envMapIntensity }
    />
</mesh>
```


### 5.5.2 - HDR Map

Just load the HDR file

``` javascript
<Environment
    background
    files={ './environmentMaps/the_sky_is_on_fire_2k.hdr' }
/>
```

### 5.5.3 - Preset

Presets from Poly Haven

* [Presets list](https://github.com/pmndrs/drei/blob/master/src/helpers/environment-assets.ts)

``` javascript
<Environment
    background
    preset="sunset"
/>
```

### 5.5.4 - Custom

We can add geometries within the environment map

``` javascript
<Environment
    background
    preset='city'
>
    <mesh
        position={ [0, 4, -5] }
        scale={ 10 }
    >
        <planeGeometry />
        <meshBasicMaterial color={ "#248181"} />
    </mesh>
</Environment>
```

### 5.5.5 Custom Lights

``` javascript
import { Lightformer, Environment } from '@react-three/drei'

<Environment
    background
>
    <Lightformer
        position={ [0, 4, -5] }
        scale={ 10 }
        color={ "#117568" }
        intensity={ 10 }
        form="ring"
    />
</Environment>
```

## 5.6 - Stage

Default stage

* [Stage](https://github.com/pmndrs/drei#staging)

``` javascript
import { Stage } from '@react-three/drei'

<Stage
    background
    opacity={ 0.2 }
    blur={ 3 }
    environment="sunset"
>
    <mesh
        castShadow
        position-x={ - 2 }
        position-y={ 1 }
    >
        <sphereGeometry />
        <meshStandardMaterial
            color="#156356"
            envMapIntensity={ envMapIntensity }
        />
    </mesh>

    <mesh
        castShadow
        ref={ cube }
        position-x={ 2 }
        position-y={ 1 }
        scale={ 1.5 }
    >
        <boxGeometry />
        <meshStandardMaterial
            color="#681e5e"
            envMapIntensity={ envMapIntensity }
        />
    </mesh>
</Stage>
```

------


# 6 - Load Models

1. [Loader and Draco](https://github.com/ivanxavier7/react-three-fiber#61---loader-and-draco)
2. [Loading Bigger Models](https://github.com/ivanxavier7/react-three-fiber#62---loading-bigger-models)
3. [Drei](https://github.com/ivanxavier7/react-three-fiber#63---drei)
4. [Multiple instances](https://github.com/ivanxavier7/react-three-fiber#64---multiple-instances)
5. [GLTF to Component](https://github.com/ivanxavier7/react-three-fiber#65---gltf-component)
6. [Animations](https://github.com/ivanxavier7/react-three-fiber#66---animations)


## 6.1 - Loader and Draco

Load models with simple leader and draco, the recommended way is below with `Drei`.


``` javascript
import { useLoader } from '@react-three/fiber'
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'
import { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader'

{/*
const model = useLoader(
    GLTFLoader, 
    './hamburger.glb'
)
*/}

const model = useLoader(
    GLTFLoader,
    './hamburger-draco.glb',
    (loader) =>
    {
        const dracoLoader = new DRACOLoader()
        dracoLoader.setDecoderPath('./draco/')
        loader.setDRACOLoader(dracoLoader)
    })

<primitive
    object={ model.scene }
    scale={ 0.35 }
    position-y={ -1 }
/>
```

## 6.2 - Loading Bigger models

When we want to start using the website before the models load we must use the `Suspense` component.

The `FallBack` attribute allows you to replace the model with something while it is not loaded.

`Model.jsx`
``` javascript
import { useLoader } from '@react-three/fiber'
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'
import { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader'

export default function Model()
{
    {/*
    const model = useLoader(
        GLTFLoader, 
        './hamburger.glb'
    )
    */}

    const model = useLoader(
        GLTFLoader,
        './FlightHelmet/glTF/FlightHelmet.gltf',
        (loader) =>
        {
            const dracoLoader = new DRACOLoader()
            dracoLoader.setDecoderPath('./draco/')
            loader.setDRACOLoader(dracoLoader)
        }
    )

    return <primitive
        object={ model.scene }
        scale={ 5 }
        position-y={ -1 }
    />
}
```

`PlaceHolder.jsx`
``` javascript
export default function Placeholder(props)
{
    return <mesh { ...props /* Retreive all the properties defined in the mesh instatiation*/>}>
        <boxGeometry
            args={ [ 1, 1, 1, 2, 2, 2] }
        />
        <meshBasicMaterial
            wireframe
            color={"red"}
        />
    </mesh>
}
```

`Experience.jsx`
``` javascript
import { Suspense } from 'react'
import Model from './Model'
import Placeholder from './Placeholder'

<Suspense
    fallback={ <Placeholder
        position-y={ 0.5 }
        scale={ [ 2, 3, 2 ] }
    /> }
>
    <Model />
</Suspense>
```


## 6.3 - Drei

1. [Loading](https://github.com/ivanxavier7/react-three-fiber#631---loading)
2. [Preloading](https://github.com/ivanxavier7/react-three-fiber#632---preloading)


### 6.3.1 - Loading

Recommended way to load models, supports Draco compression.

* `useGLTF`

``` javascript
import { useGLTF } from '@react-three/drei'

export default function Model()
{
    const model = useGLTF('./hamburger-draco.glb')

    return <primitive
        object={ model.scene }
        scale={ 0.35 }
        position-y={ -1 }
    />
}
```


### 6.3.2 - Preloading

Allows you to load components even if they are not yet in use, we can use this as an introduction to hide the loading of more complex objects.

* `useGLTF`

``` javascript
import { useGLTF } from '@react-three/drei'

export default function Model()
{
    const model = useGLTF('./hamburger-draco.glb')

    return <primitive
        object={ model.scene }
        scale={ 0.35 }
        position-y={ -1 }
    />
}

useGLTF.preload('./hamburger-draco.glb')
```

### 


## 6.4 - Multiple instances

Add multiple instances of the object using the same geometry using `Clone`.

``` javascript
import { Clone, useGLTF } from '@react-three/drei'

export default function Model()
{
    const model = useGLTF('./hamburger-draco.glb')

    return <>
        <Clone
            object={ model.scene }
            scale={ 0.35 }
            position-y={ -1 }
        />
        <Clone
            object={ model.scene }
            scale={ 0.35 }
            position-y={ -1 }
            position-x={ -3.4 }
        />
        <Clone
            object={ model.scene }
            scale={ 0.35 }
            position-y={ -1 }
            position-x={ 3.4 }
        />
    </>
}
```


## 6.5 - GLTF Component

1. [Convert](https://github.com/ivanxavier7/react-three-fiber#651---convert)
2. [Import and Shadow Acne](https://github.com/ivanxavier7/react-three-fiber#652---import-and-shadow-acne)

Converts a GLTF template to a React THREE Fiber component. We can tweak the menu before copying the result.

* [Converter script](https://github.com/pmndrs/gltfjsx)

* [Online converter](https://gltf.pmnd.rs/)

Create a component with the name of the model and copy the result into the file.
 * Add the dot `./hamburger-draco.glb`
 * Add export `export default function`
 * Change function name `function Hamburger(props)`
 * Import
 * Change diferent parts of the model if needed


### 6.5.1 - Convert
`Hamburger.jsx`
``` javascript
import React, { useRef } from "react";
import { useGLTF } from "@react-three/drei";


export default function Hamburger(props)
{
    const { nodes, materials } = useGLTF("./hamburger-draco.glb");
    return (
        <group {...props} dispose={null}>
            <mesh
                castShadow
                receiveShadow
                geometry={nodes.bottomBun.geometry}
                material={materials.BunMaterial}
            />
            <mesh
                castShadow
                receiveShadow
                geometry={nodes.meat.geometry}
                material={materials.SteakMaterial}
                position={[0, 2.817, 0]}
            />
            <mesh
                castShadow
                receiveShadow
                geometry={nodes.cheese.geometry}
                material={materials.CheeseMaterial}
                position={[0, 3.04, 0]}
            />
            <mesh
                castShadow
                receiveShadow
                geometry={nodes.topBun.geometry}
                material={materials.BunMaterial}
                position={[0, 1.771, 0]}
            />
        </group>
    );
}

useGLTF.preload("/hamburger-draco.glb");
```


### 6.5.2 - Import and Shadow Acne

Fix on the bias or shadowBias of the directional light shadow

`Experience.jsx`
``` javascript
import Hamburger from './Hamburger'

<directionalLight
    shadow-normalBias={ 0.04 }
    castShadow
    position={ [ 1, 2, 3 ] }
    intensity={ 1.5 }
/>

<Hamburger
    scale={ 0.35 }
/>
```


## 6.6 - Animations

1. [Load](https://github.com/ivanxavier7/react-three-fiber#661---load)
2. [Transitions](https://github.com/ivanxavier7/react-three-fiber#662---transitions)
3. [Control with GUI / Leva](https://github.com/ivanxavier7/react-three-fiber#663---control-with-gui--leva)


### 6.6.1 - Load

We use model animations with `useAnimations`.

`Fox.jsx`
``` javascript
import { useAnimations, useGLTF } from "@react-three/drei"
import { useEffect } from "react"

export default function Fox()
{
    const fox = useGLTF('./Fox/glTF/Fox.gltf')
    const animations = useAnimations(fox.animations, fox.scene)
    console.log(animations.actions)

    useEffect(() => 
    {
        const action = animations.actions.Run
        action.play()
    }, [])


    return <primitive
        object={ fox.scene }
        scale={ 0.025 }
        position={ [ -2.5, 0, 2.5 ] }
        rotation-y={ 0.3 }
    />
}
```

`Experience.jsx`
``` javascript
import Fox from './Fox'

<Fox />
```

### 6.6.2 - Transitions

``` javascript
useEffect(() => 
{   animations.actions.Run.play()
    
    window.setTimeout(() =>
    {
        animations.actions.Walk.play()
        animations.actions.Walk.crossFadeFrom(animations.actions.Run, 1)
    }, 2000)
}, [])
```

### 6.6.3 - Control with GUI / Leva

Better way to ask object to start animation, can be integrated with previous transition.

``` javascript
import { useAnimations, useGLTF } from "@react-three/drei"
import { useEffect } from "react"
import { useControls } from 'leva'

export default function Fox()
{
    const fox = useGLTF('./Fox/glTF/Fox.gltf')
    const animations = useAnimations(fox.animations, fox.scene)
    // console.log(animations.actions)

    const { animationName } = useControls({
        animationName: { options: animations.names }
    })

    useEffect(() => 
    {
        const action = animations.actions[animationName]
        action
            .reset()
            .fadeIn(0.5)
            .play()

        return () => 
        {
            // Remove old animation so as not to mix them
            action.fadeOut(0.5)
        }
        
    }, [animationName])


    return <primitive
        object={ fox.scene }
        scale={ 0.025 }
        position={ [ -2.5, 0, 2.5 ] }
        rotation-y={ 0.3 }
    />
}
```


------


# 7 - 3D Text

1. [Setup](https://github.com/ivanxavier7/react-three-fiber#71---setup)
2. [Particles](https://github.com/ivanxavier7/react-three-fiber#72---particles)
3. [Animate](https://github.com/ivanxavier7/react-three-fiber#73----animate)


## 7.1 - Setup

1. [Text Parameters](https://github.com/ivanxavier7/react-three-fiber#711-text-parameters)
2. [Matcap](https://github.com/ivanxavier7/react-three-fiber#712-matcap)


### 7.1.1 Text Parameters

[Text Parameters](https://threejs.org/docs/#examples/en/geometries/TextGeometry)

* font
* size
* height
* curveSegments
* bevelEnabledue
* bevelThickness
* bevelSize
* bevelOffset
* bevelSegments


### 7.1.2 Matcap

[Matcap Materials](https://github.com/emmelleppi/matcaps)

It is not recommended to use the helper from `drei` to load this material, because it depends on a connection to the server to download the matcap textures.

To choose a texture we just need an identifier:

* [736655_D9D8D5_2F281F_B1AEAB](https://github.com/emmelleppi/matcaps/blob/master/PAGE-16.md#736655_d9d8d5_2f281f_b1aeab)
* [161B1F_C7E0EC_90A5B3_7B8C9B](https://github.com/emmelleppi/matcaps/blob/master/PAGE-2.md#161b1f_c7e0ec_90a5b3_7b8c9b)

``` javascript
import { useMatcapTexture, Center ,Text3D } from '@react-three/drei'

export default function Experience()
{
    const [ matCapTexture ] = useMatcapTexture('736655_D9D8D5_2F281F_B1AEAB', 512)

    return <>
        <Center>
            <Text3D font="./fonts/helvetiker_regular.typeface.json">
                Ivan Xavier
                <meshMatcapMaterial matcap={ matCapTexture } />
            </Text3D>
        </Center>
    </>
}
```

## 7.2 - Particles

1. [React Fiber](https://github.com/ivanxavier7/react-three-fiber#721---react-fiber)
2. [Three.js](https://github.com/ivanxavier7/react-three-fiber#722---threejs)


### 7.2.1 - React Fiber
Use spread operator in a fixed array to map through each of the spaces.

``` javascript
import { useMatcapTexture } from '@react-three/drei'
import { useState } from 'react'

export default function Experience()
{
    const [ torusGeometry, setTorusGeometry ] = useState()
    const [ matCapMaterial, setMatCapMaterial ] = useState()

    const [ matCapTexture ] = useMatcapTexture('736655_D9D8D5_2F281F_B1AEAB', 512)

    return <>

        <torusGeometry
            ref={ setTorusGeometry }
            args={ [ 1, 0.6, 16, 32 ] }
        />
        <meshMatcapMaterial
            ref={ setMatCapMaterial }
            matcap={ matCapTexture }
        />
        { [...Array(100)].map((value, index) =>
                <mesh
                    geometry={ torusGeometry }
                    material={ matCapMaterial }
                    key={ index }
                    position={ [
                        (Math.random() - 0.5) * 10,
                        (Math.random() - 0.5) * 10,
                        (Math.random() - 0.5) * 10
                    ]}
                    scale={ 0.2 + Math.random() * 0.2 }
                    rotation={ [
                        Math.random() * Math.PI,
                        Math.random() * Math.PI,
                        0
                    ]}
                >
                </mesh>
            )
        }
    </>
}
```

### 7.2.2 - Three.js

``` javascript
import { useMatcapTexture } from '@react-three/drei'
import { useEffect } from 'react'
import * as THREE from 'three'

const torusGeometry = new THREE.TorusGeometry(1, 0.6, 16, 32)
const matCapMaterial = new THREE.MeshMatcapMaterial()

export default function Experience()
{
    const [ matCapTexture ] = useMatcapTexture('736655_D9D8D5_2F281F_B1AEAB', 512)

    useEffect(() =>
    {
        matCapTexture.colorSpace = THREE.SRGBColorSpace
        matCapTexture.needsUpdate = true

        matCapMaterial.matcap = matCapTexture
        matCapMaterial.needsUpdate = true
    }, [])

    return <>
        { [...Array(100)].map((value, index) =>
                <mesh
                    geometry={ torusGeometry }
                    material={ matCapMaterial }
                    key={ index }
                    position={ [
                        (Math.random() - 0.5) * 10,
                        (Math.random() - 0.5) * 10,
                        (Math.random() - 0.5) * 10
                    ]}
                    scale={ 0.2 + Math.random() * 0.2 }
                    rotation={ [
                        Math.random() * Math.PI,
                        Math.random() * Math.PI,
                        0
                    ]}
                >
                </mesh>
            )
        }
    </>
}
```

## 7.3 -  Animate

1. [Group](https://github.com/ivanxavier7/react-three-fiber#731---group)
2. [Array](https://github.com/ivanxavier7/react-three-fiber#732---array)


### 7.3.1 - Group

`useRef` to associate to a `group` to animate(`useFrame`) groups of objects.

``` javascript
import { useRef } from 'react'
import { useFrame } from '@react-three/fiber'

export default function Experience()
{
    const donutsGroup = useRef()

    useFrame((state, delta) =>
    {
        for(const donut of donutsGroup.current.children)
        {
            donut.rotation.y += delta * 0.2
        }
    })

    return <>
        <group
            ref={ donutsGroup }
        >
            { [...Array(100)].map((value, index) =>
                    <mesh
                        geometry={ torusGeometry }
                        material={ matCapMaterial }
                        key={ index }
                        position={ [
                            (Math.random() - 0.5) * 10,                        
                            (Math.random() - 0.5) * 10,
                            - Math.max(2,(Math.random() - 0.5) * -10),
                        ]}
                        scale={ 0.2 + Math.random() * 0.005 }
                        rotation={ [
                            Math.random() * Math.PI,
                            Math.random() * Math.PI,
                            0
                        ]}
                    >
                    </mesh>
                )
            }
        </group>
    </>
}
```

### 7.3.2 - Array

``` javascript
import { useRef } from 'react'
import { useFrame } from '@react-three/fiber'

export default function Experience()
{
    const donuts = useRef([])

    useFrame((state, delta) =>
    {
        for(const donut of donuts.current)
        {
            donut.rotation.y += delta * 0.2
        }
    })

    return <>
        { [...Array(100)].map((value, index) =>
                <mesh
                    ref={ (element) => 
                    {
                        donuts.current[index] = element
                    }}
                >
                </mesh>
            )
        }
    </>
}
```


------


# 8 - Baked Models and Shaders

1. [Loading Baked Models](https://github.com/ivanxavier7/react-three-fiber#81---loading-baked-models)
2. [Drei Particles](https://github.com/ivanxavier7/react-three-fiber#82---drei-particles)
3. [Shader Materials](https://github.com/ivanxavier7/react-three-fiber#83---shader-materials)



## 8.1 - Loading Baked Models
Set `flat` to get THREE.NoToneMapping, this allows some materials to go beyond the normal values, to simulate lights with colors.

`index.jsx`
``` javascript
    <Canvas
        flat
    >
    </Canvas>
```

`Experience.jsx`
``` javascript
import { Center, useTexture, useGLTF, OrbitControls } from '@react-three/drei'

export default function Experience()
{
    const { nodes } = useGLTF('./model/portal.glb')
    console.log(nodes)

    const bakedTexture = useTexture('./model/baked.jpg')
    bakedTexture.flipY = false

    return <>

        <color args={ ['#030202'] } attach="background"/>

        <OrbitControls makeDefault />

        <Center
            rotation={ [
                Math.PI * -0.10,
                Math.PI * -0.85,
                Math.PI * -0.01
            ] }
        >
            <mesh
                geometry={ nodes.baked.geometry}
                position={ nodes.baked.position }
                rotation={ nodes.baked.rotation }
            >
                <meshBasicMaterial
                    map={ bakedTexture }
                />
            </mesh>

            <mesh
                geometry={ nodes.poleLightA.geometry }
                position={ nodes.poleLightA.position }
                rotation={ nodes.poleLightA.rotation }
            >
                <meshBasicMaterial color="#ffffb0" />
            </mesh>

            <mesh
                geometry={ nodes.poleLightB.geometry }
                position={ nodes.poleLightB.position }
                rotation={ nodes.poleLightB.rotation }
            >
                <meshBasicMaterial color="#ffffb0" />
            </mesh>

            <mesh
                geometry={ nodes.portalLight.geometry }
                position={ nodes.portalLight.position }
                rotation={ nodes.portalLight.rotation }
            >
                <meshBasicMaterial color="#ffffff" />"
            </mesh>
        </Center>
    </>
}
```


## 8.2 - Drei Particles

[Drei helper](https://github.com/pmndrs/drei#sparkles)

`Sparkles`

``` javascript
import { Sparkles } from '@react-three/drei'

<Sparkles
    size={ 2 }
    scale={ [ 4, 2, 4]}
    position-y={ 1 }
    speed={ 0.2 }
    count={ 20 }
    color="#2cb5c7"
/>
```


## 8.3 - Shader Materials


See the shaders and patterns section in the [THREE repository](https://github.com/ivanxavier7/three.js/tree/main/02%20-%20Advanced/08%20-%20Shaders) to help manipulate the different patterns with mathematical equations. This section is dedicated only to integrating Shader with Fiber.

Dont forget to add the `uniforms{}` needed:
* uTime
* uColorStart
* uColorEnd


``` bash
npm i vite-plugin-glsl
```

``` javascript
import { shaderMaterial, Center, useTexture, useGLTF, OrbitControls } from '@react-three/drei'

import portalVertexShader from './shaders/portal/vertex.glsl'
import portalFragmentShader from './shaders/portal/fragment.glsl'

import * as THREE from 'three'
import { useFrame, extend } from '@react-three/fiber'
import { useRef } from 'react'

const PortalMaterial = shaderMaterial(
    {
        uTime: 0,
        uColorStart: new THREE.Color('#ffffff'),
        uColorEnd: new THREE.Color('#000000'),
    },
    portalVertexShader,
    portalFragmentShader
)

extend({ PortalMaterial })

export default function Experience()
{
    const portalMaterial = useRef()
    useFrame((state, delta) =>
    {
        portalMaterial.current.uTime += delta
    })

    const { nodes } = useGLTF('./model/portal.glb')
    console.log(nodes)

    const bakedTexture = useTexture('./model/baked.jpg')
    bakedTexture.flipY = false

    return <>

        <color args={ ['#030202'] } attach="background"/>

        <OrbitControls makeDefault />

        <Center
            rotation={ [
                Math.PI * -0.10,
                Math.PI * -0.85,
                Math.PI * -0.01
            ] }
            position={ [-1, 0, -2] }
        >
            <mesh
                geometry={ nodes.portalLight.geometry }
                position={ nodes.portalLight.position }
                rotation={ nodes.portalLight.rotation }
            >
                <portalMaterial
                    ref={ portalMaterial }
                />
            </mesh>
        </Center>
    </>
}
```


------


# 9 - Mouse Events and Raycasting

1. [Event Example](https://github.com/ivanxavier7/react-three-fiber#91---event-example)
2. [Event Information](https://github.com/ivanxavier7/react-three-fiber#92---event-information)
3. [Types of Events](https://github.com/ivanxavier7/react-three-fiber#93---types-of-events)
4. [Applications](https://github.com/ivanxavier7/react-three-fiber#94---applications)
5. [Occluding / Block Ray](https://github.com/ivanxavier7/react-three-fiber#95---occlusion--block-ray)
6. [Cursor](https://github.com/ivanxavier7/react-three-fiber#96---cursor)
7. [Model Events](https://github.com/ivanxavier7/react-three-fiber#97---model-events)
8. [Performance](https://github.com/ivanxavier7/react-three-fiber#98---performance)

## 9.1 - Event Example

``` javascript
import { useRef } from 'react'

const cube = useRef()

const eventHandler = () =>
{
    cube.current.material.color.set(`hsl(${Math.random() * 360}, 100%, 75%)`)
}

<mesh
    ref={ cube }
    onClick={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

## 9.2 - Event Information

Information about the event associated with the click, we can see the objects that are interconnected or associate the distance or coordinates of the contact point with something.

``` javascript
    })

    const eventHandler = (event) =>
    {
        console.log(event)
        console.log("Distance: ", event.distance)           // Ditance between the camera and hit point
        console.log("Point: ", event.point)                 // Hit point (x,y,z)
        console.log("Uv: ", event.uv)                       // Uv coordinates of the hit point
        console.log("Object: ", event.object)               // Object triggered
        console.log("Event Object: ", event.eventObject)    // Object listening

        console.log("X: ", event.x)                         // Pointer X (x, y)
        console.log("Y: ", event.y)                         // Pointer Y (x, y)

        console.log("Shift Key: ", event.shiftKey)          // Shift key pressed
        console.log("Control Key: ", event.ctrlKey)         // Control key pressed
        console.log("Command Key: ", event.metaKey)         // Command key pressed
    }
```

## 9.3 - Types of Events

1. [Click](https://github.com/ivanxavier7/react-three-fiber#931---click)
2. [Right Click](https://github.com/ivanxavier7/react-three-fiber#932---right-click)
3. [Double Click](https://github.com/ivanxavier7/react-three-fiber#933---double-click)
4. [Pointer Up](https://github.com/ivanxavier7/react-three-fiber#934---pointer-up)
5. [Pointer Down](https://github.com/ivanxavier7/react-three-fiber#935---pointer-down)
6. [Pointer Over](https://github.com/ivanxavier7/react-three-fiber#936---pointer-over)
7. [Pointer Enter](https://github.com/ivanxavier7/react-three-fiber#937---pointer-enter)
8. [Pointer Out](https://github.com/ivanxavier7/react-three-fiber#938---pointer-out)
9. [Pointer Leave](https://github.com/ivanxavier7/react-three-fiber#939---pointer-leave)
10. [Pointer Move](https://github.com/ivanxavier7/react-three-fiber#9310---pointer-move)
11. [Pointer Miss](https://github.com/ivanxavier7/react-three-fiber#9311---pointer-miss)

### 9.3.1 - Click

`onClick()`

Allows you to listen for a click event.

``` javascript
<mesh
    ref={ cube }
    onClick={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.2 - Right Click

`onContextMenu`

* Desktop -> `Right Click`
* Mobile -> Pressing for a while

``` javascript
<mesh
    ref={ cube }
    onContextMenu={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.3 - Double Click

`onDoubleClick`

``` javascript
<mesh
    ref={ cube }
    onDoubleClick={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.4 - Pointer Up

`onPointerUp`

* Desktop - Release the pointer
* Mobile - Stop touching

``` javascript
<mesh
    ref={ cube }
    onPointerUp={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.5 - Pointer Down

`onPointerDown`

``` javascript
<mesh
    ref={ cube }
    onPointerDown={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.6 - Pointer Over

`onPointerOver`

When the pointer hover the objects, multiple objects.

``` javascript
<mesh
    ref={ cube }
    onPointerOver={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.7 - Pointer Enter

`onPointerEnter`

When the pointer enter the object, single object.

``` javascript
<mesh
    ref={ cube }
    onPointerEnter={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.8 - Pointer Out

`onPointerOut`

When the pointer stop hovering the objects, multiple objects.

``` javascript
<mesh
    ref={ cube }
    onPointerOut={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.9 - Pointer Leave

`onPointerLeave`

When the pointer leaves the object, single object.

``` javascript
<mesh
    ref={ cube }
    onPointerLeave={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.10 - Pointer Move

`onPointerMove`

When the pointer moves overing the object, one per frame.

``` javascript
<mesh
    ref={ cube }
    onPointerMove={ eventHandler }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```

### 9.3.11 - Pointer Miss

`onPointerMissed`

When the pointer clicks outside the object.

``` javascript
<Canvas
    camera={ {
        fov: 45,
        near: 0.1,
        far: 200,
        position: [ - 4, 3, 6 ]
    } }
    onPointerMissed={ () => {console.log('You missed the click!')}}
>
    <Experience />
    <color args={ [ '#0a0a22' ] } attach="background" />
</Canvas>
```

## 9.4 - Applications

1. On click select a object
2. Drag to draw a rectangle and wehn it releases, select all objects inside
3. When clicks with shift key, you want to add to currentyle selected objects or remove them if they were selected.
4. Click without a object, will deselect all selected objects

## 9.5 - Occlusion / Block Ray

When we click on something we send a ray, Raycaster doesn't care about the objects in front, to occlude an object, we need to tell the surrounding objects to stop propagating that event.

``` javascript
import { OrbitControls } from '@react-three/drei'
import { useRef } from 'react'

export default function Experience()
{
    const cube = useRef()

    const eventHandler = (event) =>
    {
        cube.current.material.color.set(`hsl(${Math.random() * 360}, 100%, 75%)`)
    }

    const blockCubeEvents = (event) =>
    {
        event.stopPropagation()
    }

    return <>

        <OrbitControls makeDefault />

        <mesh
            position-x={ - 2 }
            onClick={ blockCubeEvents }
        >
            <sphereGeometry />
            <meshStandardMaterial color="DarkRed" />
        </mesh>

        <mesh
            ref={ cube }
            position-x={ 2 }
            scale={ 1.5 }
            onClick={ eventHandler }
        >
            <boxGeometry />
            <meshStandardMaterial color="DarkBLue" />
        </mesh>
    </>
}
```

## 9.6 - Cursor

1. [Pointer / Finger](https://github.com/ivanxavier7/react-three-fiber#961---pointer--finger)
2. [Drei Helper - Recommended](https://github.com/ivanxavier7/react-three-fiber#962---drei-helper---recommended)

To help distinguish clickable objects, we can change the cursor to a pointing finger.

### 9.6.1 - Pointer / Finger

`onPointerEnter()` -> Change to finger
`onPointerLeave()` -> Change to default

``` javascript
export default function Experience()
{
    const pointerCursor = () =>
    {
        document.body.style.cursor = 'pointer'
    }

    const defaultCursor = () =>
    {
        document.body.style.cursor = 'default'
    }

    return <>
        <mesh
            onPointerEnter={ pointerCursor }
            onPointerLeave={ defaultCursor }
        >
            <boxGeometry />
            <meshStandardMaterial color="DarkBLue" />
        </mesh>
    </>
}
```

### 9.6.2 - Drei Helper - Recommended

[Drei Helper useCursor](https://github.com/pmndrs/drei#usecursor)

``` javascript
import { useCursor } from '@react-three/drei'
import { useState } from 'react'

export default function Experience()
{
    
    const [hovered, set] = useState()
    useCursor(hovered)

    return <>
        <mesh
            onPointerOver={() => set(true)} onPointerOut={() => set(false)}
        >
            <boxGeometry />
            <meshStandardMaterial color="DarkBLue" />
        </mesh>
    </>
}
```

## 9.7 - Model Events

Example of an event that manipulates the size and color of a model.

``` javascript
import { useFrame } from '@react-three/fiber'
import { useGLTF, useCursor, OrbitControls } from '@react-three/drei'
import { useRef, useState } from 'react'
import * as THREE from 'three'

export default function Experience()
{
    const hamburger = useRef()

    const hamburgerModel = useGLTF('./hamburger.glb')

    const modelEvent = (event) =>
    {
        event.stopPropagation() // Prevent Ray from travel trough the objects, single selection
        hamburger.current.scale.x += 0.01
        for(const children of hamburger.current.children)
        {
            children.material.color.b += 0.01
        }
    }

    return <>
        <primitive 
            ref={ hamburger }
            object={ hamburgerModel.scene }
            scale={ 0.25 }
            onClick={ modelEvent }
        />
    </>
}
```

## 9.8 - Performance

1. [Mesh Bounds / Geometries](https://github.com/ivanxavier7/react-three-fiber#981---mesh-bounds--geometries)
2. [BVH](https://github.com/ivanxavier7/react-three-fiber#982---bvh--models-or-scene)


### 9.8.1 - Mesh Bounds / Geometries
Change the Raycaster with Drei to help with performance.

Uses an invisible sphere around the object to reduce the calculations required for events.

[Drei meshBounds Helper](https://github.com/pmndrs/drei#meshbounds)


``` javascript
import { meshBounds } from '@react-three/drei'

<mesh
    raycast={ meshBounds }
>
    <boxGeometry />
    <meshStandardMaterial color="DarkBLue" />
</mesh>
```


### 9.8.2 - BVH / Models or Scene

[Bounding Volume Hierarchy](https://github.com/pmndrs/drei#bvh)

Speeds up the raycaster drastically decreasing its accuracy.

``` javascript
import { Bvh } from '@react-three/drei'

<Bvh>
    <primitive 
        ref={ hamburger }
        object={ hamburgerModel.scene }
        scale={ 0.25 }
        position-y={ 0.7 }
        onClick={ modelEvent }
    />
</Bvh>
```


------


# 10 - Post-processing

1. Setup
2. Blending / Coloring
3. Effects
4. Custom Effect

Post-processing

* [Repository](https://github.com/pmndrs/postprocessing)
* [Documentation](https://pmndrs.github.io/postprocessing/public/docs/)
* [Examples](https://pmndrs.github.io/postprocessing/public/demo/#antialiasing)

React Post-processing

* [Repository](https://github.com/pmndrs/react-postprocessing)
* [Documentation](https://docs.pmnd.rs/react-postprocessing/introduction)
* [List](https://github.com/pmndrs/postprocessing#included-effects)


## 10.1 - Setup

1. Install

``` bash
npm install @react-three/postprocessing@2.14
```

2. Define a background, transparent background could lead to bugs with the effects.
``` javascript 
<color args={ [ '#ffffff' ] } attach="background" />
```

## 10.2 - Blending / Coloring

Available in all effects, defines how effect colors are applied.

`blendFunction`

Most used:
* OVERLAY
* SCREEN
* SOFT_LIGHT
* AVERAGE

``` bash
npm install postprocessing@6.33
```

`BlendFunction.NORMAL` is the default

``` javascript
import { BlendFunction } from 'postprocessing'
console.log(BlendFunction) // List of options

<Vignette
    offset={ 0.3 }
    darkness={ 0.9 }
    blendFunction={ BlendFunction.COLOR_BURN }
/>
```

## 10.3 - Effects

1. Vignette
2. Glitch
3. Noise
4. Bloom
5. Depth of Field
6. SSR (Screen Space Reflection)

### 10.3.1 - Vignette

Corners of the screen become darker.

``` javascript
import { Vignette, EffectComposer } from '@react-three/postprocessing'

<EffectComposer
    multisampling={ 0 }
>
    <Vignette
        offset={ 0.3 }
        darkness={ 0.9 }
    />
</EffectComposer>
```

### 10.3.2 - Glitch

Some noise and Glitch the screen after a while.

``` javascript
import { Glitch, EffectComposer } from '@react-three/postprocessing'
import { GlitchMode } from 'postprocessing'

<EffectComposer
    multisampling={ 0 }
>
    <Glitch
        delay={ [ 0.5, 1 ] }
        duration={ [ 0.1, 0.3 ] }
        strength={ [0.2, 0.4] }
        mode={ GlitchMode.SPORADIC }
    />
</EffectComposer>
```

### 10.3.3 - Noise

Add noise to the screen.

``` javascript
import { Noise, EffectComposer } from '@react-three/postprocessing'
import { BlendFunction } from 'postprocessing'

<EffectComposer
    multisampling={ 0 }
>
    <Noise
        premultiply
        blendFunction={ BlendFunction.SOFT_LIGHT }
    />
</EffectComposer>
```

### 10.3.4 - Bloom

1. Increase RGB levels
2. Default Colors

Make the objects glow.

The combination of surrounding lights can increase the RGB values, making it shine brighter in certain areas, this may not be realistic if we are simulating a light-emitting object.

#### 10.3.4.1 - Increase RGB levels

Colors with more than 0.9 will glow, so we need to turn off the ToneMapping.

Should use this technique with `meshBasicMaterial`, we cant use `emissive` in this material.

``` javascript
import { Bloom, EffectComposer } from '@react-three/postprocessing'

<EffectComposer
    multisampling={ 0 }
>
    <Bloom
        mipmapBlur
    />
</EffectComposer>

<mesh>
    <boxGeometry />
    <meshStandardMaterial
        toneMapped={ false }
        color={ [ 1.5, 1, 4]}
    />
</mesh>
```

#### 10.3.4.2 - Default Colors

``` javascript
import { Bloom, EffectComposer } from '@react-three/postprocessing'


<EffectComposer
    multisampling={ 0 }
>
    <Bloom
        mipmapBlur
        intensity={ 0.5 }
        luminanceThreshold={ 0.8 }
    />
</EffectComposer>


<mesh>
    <boxGeometry />
    <meshStandardMaterial
        toneMapped={ false }
        color={"lightGreen"}
        emissive="cyan"
        emissiveIntensity={ 3 }
    />
</mesh>
```

### 10.3.5 - Depth of Field

blurs objects that are more distant, increasing the reality of the scene.

Values from 0 to 1.

``` javascript	
import { DepthOfField, EffectComposer } from '@react-three/postprocessing'

        <EffectComposer
            multisampling={ 0 }
        >
            <DepthOfField 
                focusDistance={ 0.025 }
                focalLength={ 0.025 }
                bokehScale={ 2 }
            />
        </EffectComposer>
```

### 10.3.6 - SSR (Screen Space Reflection)

Add reflections to the scene.

We should use a example with this effect to simplify is usage.

* [SSR Example](https://codesandbox.io/s/ssr-test-8pbw1f)

* [Other examples](https://docs.pmnd.rs/react-three-fiber/getting-started/examples)

``` javascript	
import { SSR } from '@react-three/postprocessing'
import { useControls } from 'leva'

const ssrProps = useControls('SSR Effect', {
    temporalResolve: true,
    STRETCH_MISSED_RAYS: true,
    USE_MRT: true,
    USE_NORMALMAP: true,
    USE_ROUGHNESSMAP: true,
    ENABLE_JITTERING: true,
    ENABLE_BLUR: true,
    temporalResolveMix: { value: 0.9, min: 0, max: 1 },
    temporalResolveCorrectionMix: { value: 0.25, min: 0, max: 1 },
    maxSamples: { value: 0, min: 0, max: 1 },
    resolutionScale: { value: 1, min: 0, max: 1 },
    blurMix: { value: 0.5, min: 0, max: 1 },
    blurKernelSize: { value: 8, min: 0, max: 8 },
    blurSharpness: { value: 0.5, min: 0, max: 1 },
    rayStep: { value: 0.3, min: 0, max: 1 },
    intensity: { value: 1, min: 0, max: 5 },
    maxRoughness: { value: 0.1, min: 0, max: 1 },
    jitter: { value: 0.7, min: 0, max: 5 },
    jitterSpread: { value: 0.45, min: 0, max: 1 },
    jitterRough: { value: 0.1, min: 0, max: 1 },
    roughnessFadeOut: { value: 1, min: 0, max: 1 },
    rayFadeOut: { value: 0, min: 0, max: 1 },
    MAX_STEPS: { value: 20, min: 0, max: 20 },
    NUM_BINARY_SEARCH_STEPS: { value: 5, min: 0, max: 10 },
    maxDepthDifference: { value: 3, min: 0, max: 10 },
    maxDepth: { value: 1, min: 0, max: 1 },
    thickness: { value: 10, min: 0, max: 10 },
    ior: { value: 1.45, min: 0, max: 2 }
})

<EffectComposer
    multisampling={ 0 }
>
    <SSR 
        {...ssrProps}
    />
</EffectComposer>
```

## 10.4 - Custom Effect

[Custom Effect Post-processing](https://github.com/pmndrs/postprocessing/wiki/Custom-Effects)
[Custom Effect React-Post-processing](https://github.com/pmndrs/react-postprocessing)

Custom effect that animates, distorts the scene and changes its color.

`BlendFunction()` and `useRef()` were configured to be an effect with the same options as those in EffectCompose, but they are not strictly necessary.


* `const` - Static
* `in` - Input
* `out` - Output
* `inout` - Both

* `inputColor` - Input pixels
* `uv` - Render coordinates
* `outputColor` - Output pixels


`DrunkEffect.jsx`
``` javascript
import { BlendFunction, Effect } from 'postprocessing'

const fragmentShader = `
    uniform float frequency;
    uniform float amplitude;
    uniform float offset;

    void mainUv(inout vec2 uv)
    {
        uv.y += sin(uv.x * frequency + offset) * amplitude;
    }

    void mainImage(const in vec4 inputColor, const in vec2 uv, out vec4 outputColor)
    {
        vec4 color = inputColor;
        color.rgb *= vec3(0.6, 1.0, 0.7);

        outputColor = color;
    }
`

export default class DrunkEffect extends Effect
{
    constructor({ frequency = 2, amplitude = 0.2, blendFunction = BlendFunction.NORMAL})
    {
        super(
            'DrunkEffect',
            fragmentShader,
            {
                uniforms: new Map([
                    [ 'frequency', { value: frequency } ],
                    [ 'amplitude', { value: amplitude } ],
                    [ 'offset', { value: 0 } ],
                ]),
                blendFunction
            }
        )
    }

    update(renderer, inputBuffer, deltaTime)
    {
        this.uniforms.get('offset').value += deltaTime
    }
}
```

`Drunk.jsx`
``` javascript
import DrunkEffect from "./DrunkEffect"
import { forwardRef } from "react"

export default forwardRef(function Drunk(props, ref)
{
    const effect = new DrunkEffect(props)

    return <primitive ref={ ref } object={ effect } />
})
```

`Experience.jsx`
``` javascript
import { OrbitControls } from '@react-three/drei'
import { Perf } from 'r3f-perf'
import { EffectComposer } from '@react-three/postprocessing'

import { useControls } from 'leva'

import { BlendFunction } from 'postprocessing'

import Drunk from './Drunk'
import { useRef } from 'react'

export default function Experience()
{
    const drunkRef = useRef()

    const drunkProps = useControls('Drunk Effect',
    {
        frequency: { value: 2, min: 1, max: 20},
        amplitude: { value: 0.2, min:0, max: 1}
    })

    return <>
        <color args={ [ '#ffffff' ] } attach="background" />
        <EffectComposer
            multisampling={ 0 }
        >
            <Drunk
                useRef={ drunkRef }
                frequency={ drunkProps.frequency }
                amplitude={ drunkProps.amplitude }
                blendFunction={ BlendFunction.COLOR_BURN }
            />
        </EffectComposer>

        <Perf position="top-left" />
    </>
}
```


------


# 11 - Physics


# Physics

1. Create World and Colliders
2. Access the Body and Forces
3. Physical Object
4. Events
5. Models
6. Stress test and Invisible walls

`Rapier`

[Documentation](https://rapier.rs/docs/user_guides/javascript/getting_started_js/)
[API](https://rapier.rs/javascript3d/index.html)
[React Fiber Examples](https://github.com/pmndrs/react-three-rapier#readme)
[More examples](https://docs.pmnd.rs/react-three-fiber/getting-started/examples)

We must use thick plans to facilitate calculations, plans with minimum thickness create problems.


## 11.1 - Create World and Colliders

* `<Physics>` - Objects affected by forces
* `<RigidBody>` - Defines the object as physical, we can put different meshes and will act as one object
* Colliders - Shape of the rigid body, use `debug` to see them.

Default Colliders:
* ball
* cuboid
* hull
* trimesh - avoid, for holes inside objects like donuts or terrain
* custom - its scalable for complex models

Don't change their position after attaching them to the object.
If needed, use this method to reset your position without speed.

Custom colliders references:
* [Ball](https://rapier.rs/javascript3d/classes/Ball.html)
* [Cube](https://rapier.rs/javascript3d/classes/Cuboid.html)
* [Round Cube](https://rapier.rs/javascript3d/classes/RoundCuboid.html)
* [Capsule](https://rapier.rs/javascript3d/classes/Capsule.html)
* [Cone](https://rapier.rs/javascript3d/classes/Cone.html)
* [Cylinder](https://rapier.rs/javascript3d/classes/Cylinder.html)
* [Hull](https://rapier.rs/javascript3d/classes/ConvexPolyhedron.html)
* [Trimesh](https://rapier.rs/javascript3d/classes/TriMesh.html)
* [Heightfield](https://rapier.rs/javascript3d/classes/Heightfield.html)


``` bash
npm install @react-three/rapier@1.0
```

``` javascript
import { RigidBody, Physics, CuboidCollider } from '@react-three/rapier'

<Physics
    debug
>
    <RigidBody
        colliders="ball"
    >
        <mesh castShadow position={ [ - 2, 4.5, 0 ] }>
            <sphereGeometry />
            <meshStandardMaterial color="#9c571e" />
        </mesh>
    </RigidBody>
    <RigidBody
        colliders={ false }
    >
        <CuboidCollider
            position={ [ - 2, 1, 0 ] }
            rotation={ [Math.PI * 0.45, 0, 0] }
            args={ [ 1, 1, 0.5] }
        />
        <mesh
            castShadow
            position={ [ - 2, 1, 0 ] }
            rotation-x={ Math.PI * 0.45}
        >
            <torusGeometry />
            <meshStandardMaterial color="#1e749c" />
        </mesh>
    </RigidBody>
    <RigidBody
        colliders="trimesh"
    >
        <mesh
            castShadow position={ [ 3, 5, 3 ] }
            rotation-x={ Math.PI * -0.05}
        >
            <torusGeometry />
            <meshStandardMaterial color="#1e749c" />
        </mesh>
    </RigidBody>
    <RigidBody>
    <mesh
        castShadow position={ [ 2, 2, 0 ] }
        scale={ [0.2, 3, 3] }
    >
        <boxGeometry />
        <meshStandardMaterial color="#685811" />
    </mesh>
    <mesh castShadow position={ [ 4, 2, 0 ] }>
        <boxGeometry />
        <meshStandardMaterial color="#d163d1" />
    </mesh>
    </RigidBody>
    <RigidBody type="fixed">
    <mesh receiveShadow position-y={ - 1.25 }>
        <boxGeometry args={ [ 10, 0.5, 10 ] } />
        <meshStandardMaterial color="#1f581f" />
    </mesh>
    </RigidBody>
</Physics>
```


## 11.2 -  Access the Body and Forces

Push
* `addForce` - Continuous force like Wind
* `addImpulse` - Impulse force for a very short time, projectile

Rotate
* `addTorque`
* `applyTorqueImpulse`

When objects are stationary, they start sleeping(`5 - Events`)

``` javascript 
const sphere = useRef()

const sphereJump = () =>
{
    sphere.current.applyImpulse({ x: 0, y: 5, z: 0})
    sphere.current.applyTorqueImpulse({
        x: Math.random() - 0.5,
        y: Math.random() - 0.5,
        z: Math.random() - 0.5
    })
}

<Physics
    debug
>
    <RigidBody
        ref={ sphere }
        colliders="ball"
    >
        <mesh
            castShadow
            position={ [ - 2, 4.5, 0 ] }
            onClick={ sphereJump }
        >
            <sphereGeometry />
            <meshStandardMaterial color="#9c571e" />
        </mesh>
    </RigidBody>
</Physics>
```


## 11.3 -  Physical Object

* Friction: Default is `0.7`
* Restitution / Bounciness: default is `0`
* Mass: Impact the collisions, needs a `Custom Collider` to modify
* Gravity: `-9.81` is the default (Hearth gravity), Moon is `-1.6`
* Gravity Scale: Change the gravity of the object

``` javascript
const sphere = useRef()

const sphereJump = () =>
{
    // Accessing Collision properties
    console.log(sphere.current.mass()) 
}

<Physics
    debug
    gravity={ [0, -1.6, 0 ] }
>
    <RigidBody
        ref={ sphere }
        colliders={ false }
        gravityScale={ 10 }
        restitution={ 3 }
        mass={ 10 }
    >
        <CuboidCollider
            position={ [ - 2, 1, 0 ] }
            rotation={ [Math.PI * 0.45, 0, 0] }
            args={ [ 1, 1, 0.5] }
        />
        <mesh
            castShadow
            position={ [ - 2, 1, 0 ] }
            rotation-x={ Math.PI * 0.45}
            onClick={ sphereJump }
        >
            <torusGeometry />
            <meshStandardMaterial color="#1e749c" />
        </mesh>
    </RigidBody>
    <RigidBody
        type="fixed"
        friction={ 0.7 }
    >
        <mesh receiveShadow position-y={ - 1.25 }>
            <boxGeometry args={ [ 10, 0.5, 10 ] } />
            <meshStandardMaterial color="#1f581f" />
        </mesh>
    </RigidBody>
</Physics>
```


## 11.4 -  Animate

For cases where it is necessary to animate an object with a specific speed, such as an obstacle.

It can be used to simulate a player moving at a specific speed and colliding with objects.


* `kinematicPosition` - Next position to move
* `kinematicVelocity` - Speed of the object

``` javascript
import { useRef } from 'react'
import { useFrame } from '@react-three/fiber'
import * as THREE from 'three'

const twister = useRef()

useFrame((state) =>
{
    const time = state.clock.getElapsedTime()
    //console.log(time)

    // Rotate
    const eulerRotation = new THREE.Euler(0.2, time * 3, 0)
    const quaternionRotation = new THREE.Quaternion()
    quaternionRotation.setFromEuler(eulerRotation)
    twister.current.setNextKinematicRotation(quaternionRotation)

    // Go around
    const angle = time * 0.5
    const x = Math.cos(angle) * 5
    const z = Math.sin(angle) * 5
    twister.current.setNextKinematicTranslation( { x: x, y: 0, z: z } )
})

<RigidBody
    ref={ twister }
    friction={ 0 }
    type='kinematicPosition'
>
    <mesh
        castShadow
        scale={ [ 0.4, 0.4, 6] }
    >
        <boxGeometry />
        <meshStandardMaterial color="#6a6b13" />
    </mesh>
</RigidBody>
```


## 11.5 -  Events

* `OnCollisionEnter` - Hit something
* `OnCollisionExit` - Sperate from the hit object
* `OnSleep` - Start sleeping
* `onWake` - Stop sleeping


When the object hits something it makes a `Sound`

``` javascript
const [ hitSound ] = useState( () => new Audio('./hit.mp3') )

const collisionEnter = () =>
{
    hitSound.currentTime = 0
    hitSound.volume = Math.random()
    hitSound.play()
}

<Physics
    debug
    gravity={ [0, -1.6, 0 ] }
>
    <RigidBody
        onCollisionEnter={ collisionEnter }
    >
        <mesh
            castShadow
            scale={ [ 0.4, 0.4, 6] }
        >
            <boxGeometry />
            <meshStandardMaterial color="#6a6b13" />
        </mesh>
    </RigidBody>
</Physics>
```


## 11.6 -  Models

We must simplify the model collider as much as possible, for better performance.

For better realist with easy implementation, use `hull` or `trimesh` colliders.

The best option is to use multiple `custom colliders`.

In the case of the hamburger, you should use a capsule with a cube simulating cheese, it will be more efficient than using Hull or trimesh and will have similar results.

Check `Joints` from Rapier to attach objects like a robot.

[Joint Documentation](https://rapier.rs/docs/user_guides/javascript/joints/)

``` javascript
import { useGLTF } from '@react-three/drei'
import { CylinderCollider } from '@react-three/rapier'

<RigidBody
    colliders={ false }
>
    <CylinderCollider
        position={ [ 8, 4, 4 ]}
        args={[ 0.52, 1.25 ]}
    />
    <primitive
        object={hamburger.scene}
        scale={ 0.25 }
        position={ [ 8, 4, 4 ]}
    />
</RigidBody>
```

## 11.7 -  Stress test and Invisible walls

`<instanceMesh>` helps create thousands of object instances if necessary with a draw call, excellent for performance.

Invisible walls and many objects to consume a lot of resources and how best to deal with it.

To create invisible objects we just need to create collision objects without associated geometries.


To set up colliders in multiple objects we need to wrap `<instanceMesh>`  inside `<InstancedRigidBodies>`  

``` javascript
import { CuboidCollider, InstancedRigidBodies } from '@react-three/rapier'
import { useMemo, useEffect } from 'react'

const objectCount = 1000
const multipleObjectsRef = useRef()

useEffect(() =>
{
    for(let i = 0; i < objectCount; i++) 
    {
        const matrix = new THREE.Matrix4()
        matrix.compose(
            new THREE.Vector3(i * 2, 0, 0),
            new THREE.Quaternion(),
            new THREE.Vector3(1, 1, 1)
        )
        multipleObjectsRef.current.setMatrixAt(i, matrix)
    }
}, [])

const instances = useMemo(() =>
{
    const instances = []

    for(let i = 0; i < objectCount; i++)
    {
        instances.push({
            key: 'instance_' + i,
            position: [
                (Math.random() - 0.5) * 8,
                6 + 1 * 0.2,
                (Math.random() - 0.5) * 8
            ],
            rotation: [ Math.random(), Math.random(), Math.random()]
        })
    }

    return instances
}, [])

<RigidBody
    type="fixed"
>
    <CuboidCollider args={ [ 10, 6, 0.5 ] } position={ [ 0, 5, 10.25] }/>
    <CuboidCollider args={ [ 10, 6, 0.5 ] } position={ [ 0, 5, -10.25] }/>
    <CuboidCollider args={ [ 0.5, 6, 10 ] } position={ [ -10.25, 5, 0] }/>
    <CuboidCollider args={ [ 0.5, 6, 10 ] } position={ [ 10.25, 5, 0] }/>
</RigidBody>
<InstancedRigidBodies instances={ instances }>
    <instancedMesh
        ref={ multipleObjectsRef }
        args={ [ null, null, objectCount]}
        castShadow
        receiveShadow
    >
        <boxGeometry />
        <meshStandardMaterial color='#5a0808' />
    </instancedMesh>
</InstancedRigidBodies>
```


------


# 12 - Projects

1. Imported Model
2. Physics Game


## 12.1.1 - Imported Model

1. Get Models
2. Optimize raycasting
3. Create Component
4. Animated Environment Map
5. Floating Clouds
6. Presentation Controls / Camera
7. Shadows
8. Lights
9. Iframe

The model can be created using blender.

## 12.1.1 - Get Models

Free models:
* [Market](https://market.pmnd.rs/)
* [Sketchfab](https://sketchfab.com/3d-models?features=downloadable&sort_by=-likeCount)
* [TurboSquid](https://market.pmnd.rs/)
* [Cgtrader](https://www.cgtrader.com/3d-models?file_types[]=117&free=1)
* [Creazilla](https://creazilla.com/sections/3-3d-models/tags/649-gltf?page=20)
* [Free3D](https://downloadfree3d.com/file-format/gltf/)

Check if they have `CC0 Licence` - Open Source

Blender can also be used with some plugins to acquire free models, making editing easier.

## 12.1.2 - Optimize raycasting

``` javascript
import { Bvh } from '@react-three/drei'

<Bvh>
    <Experience />
</Bvh>
```

## 12.1.3 - Create Component

We can export the model in other ways, such as downloading resources online, but it is not recommended in terms of performance, it will take a long time to load the resources.

[Online tool to convert glTF in Fiber meshes](https://gltf.pmnd.rs/)

Copy the result and add `default` to the function, this method allows you to get better control of the model.

`MacBook.jsx`
``` javascript
export default function MacBook(props)
{
    const { nodes, materials } = useGLTF("./macbook.gltf");

    return (
        <group {...props} dispose={null}>

              <group position={[0, 0.519, 0]} scale={0.103}>
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.Circle001.geometry}
                      material={materials["Frame.001"]}
                  />
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.Circle001_1.geometry}
                      material={materials["Frame.001"]}
                  />
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.Circle001_2.geometry}
                      material={materials.HeadPhoneHole}
                  />
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.Circle001_3.geometry}
                      material={materials.USB_C_INSIDE}
                  />
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.Circle001_4.geometry}
                      material={materials["Frame.001"]}
                  />
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.Circle001_5.geometry}
                      material={materials.TouchbarBorder}
                  />
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.Circle001_6.geometry}
                      material={materials.Keyboard}
                  />

                  <group position={[0, -0.509, 0]} scale={5.796}>
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle006.geometry}
                        material={materials["Frame.001"]}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle006_1.geometry}
                        material={materials.USB_C_INSIDE}
                    />
                  </group>

                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.FrontCameraRing001.geometry}
                      material={materials["CameraRIngBlack.002"]}
                      position={[-0.155, 19.571, -16.151]}
                      scale={5.796}
                  />

                  <group position={[-11.786, -0.15, -8.301]} scale={5.796}>
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle.geometry}
                        material={materials["Keyboard.001"]}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle_1.geometry}
                        material={materials.Key}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle_2.geometry}
                        material={materials.Touchbar}
                    />
                  </group>

                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.KeyboardKeyHole.geometry}
                      material={materials["Keyboard.001"]}
                      position={[-11.786, -0.152, -8.301]}
                      scale={5.796}
                  />
                  <mesh
                      castShadow
                      receiveShadow
                      geometry={nodes.RubberFoot.geometry}
                      material={materials.DarkRubber}
                      position={[-11.951, -0.751, 7.857]}
                      scale={5.796}
                  />

                  <group position={[0.011, -0.211, -10.559]} scale={5.796}>
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle012.1.geometry}
                        material={materials.HingeBlack}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle012_1.geometry}
                        material={materials.HingeMetal}
                    />
                  </group>

                  <group position={[-15.026, 0.031, 0.604]} scale={5.796}>
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle009.geometry}
                        material={materials["Frame.001"]}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle009_1.geometry}
                        material={materials.SpeakerHole}
                    />
                  </group>

                  <group position={[12.1.204, 0.031, 0.604]} scale={5.796}>
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle003.geometry}
                        material={materials["Frame.001"]}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle003_1.geometry}
                        material={materials.SpeakerHole}
                    />
                  </group>

                  <group
                      position={[0.007, -0.472, -10.412]}
                      rotation={[1.311, 0, 0]}
                      scale={5.796}
                  >
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle002.geometry}
                        material={materials["Frame.001"]}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle002_1.geometry}
                        material={materials.Screen}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle002_2.geometry}
                        material={materials.ScreenGlass}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle002_3.geometry}
                        material={materials.Rubber}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.Circle002_4.geometry}
                        material={materials.DisplayGlass}
                    />
                    <mesh
                        castShadow
                        receiveShadow
                        geometry={nodes.AppleLogo000.geometry}
                        material={materials["AppleLogo.004"]}
                        position={[0.005, -0.111, -1.795]}
                        rotation={[-Math.PI, Math.PI, -Math.PI]}
                        scale={0.579}
                    />
                </group>
                
            </group>
        </group>
    );
}

useGLTF.preload("./macbook.gltf");
```

`Experience.jsx`
``` javascript
import { OrbitControls } from '@react-three/drei'

import MacBook from './MacBook'

export default function Experience()
{
    return <>
        <OrbitControls makeDefault />
        
        <color args={ [ '#1e282e' ] } attach="background" />
        <MacBook />
    </>
}
```


## 12.1.4 - Animated Environment Map

To get a good result with little work, we can use Environment Mapping to light our object.

``

`EnvRing.jsx`
``` javascript
import { Bvh } from '@react-three/drei'
import { useFrame } from '@react-three/fiber'
import { useRef } from 'react'

export default function EnvRing({color, scale, speed})
{
    const ringRef = useRef()

    useFrame((state, delta) => 
    {
        //console.log(ringRef)
        const angle = state.clock.elapsedTime
        ringRef.current.position.z = -((Math.sin(angle * speed) + 1.6) + 0.8)
    })

    return <>
        <Bvh>
            <mesh
                ref={ ringRef }
                scale={ scale }
                position-y={ 0 }
                position-z={ 0 }
            >
                    <ringGeometry
                        args={ [0.93, 1, 3] }
                    />
                    <meshBasicMaterial
                        color={ color }
                        toneMapped={ false }
                    />
            </mesh>
        </Bvh>
    </>
}
```

`Experience.jsx`
``` javascript
<Environment
    blur={ 0.5 }
    background
    frames={Infinity}
    files={ './resources/hdr/woods.hdr' }
    resolution={ 1024 }
>
    <color args={ [ '#000000' ] } attach="background" />

    <EnvRing
        color={[ 20, 30, 50 ]}
        scale={ 2 }
        speed={ 0.4 }
    />

</Environment>

<OrbitControls makeDefault />

<MacBook 
    position-y={ -1 }
    position-x={ 0.4 }
/>
```

## 12.1.5 - Floating Clouds

Creation of black and floating clouds.

`FloatingClouds.jsx`
``` javascript
import { Float, Cloud, Clouds } from '@react-three/drei'

import * as THREE from 'three'

export default function FloatingClouds()
{
    return <>
        <Float
            rotationIntensity={ 0.8 }
            speed={ 0.6 }
        >
            <group
                rotation-x={Math.PI * 0.15}
            >
                <Clouds
                    scale={ 3.5 }
                    position-y={-30}
                    position-z={-25}
                    material={THREE.MeshStandardMaterial}
                >
                    <Cloud
                        segments={80}
                        bounds={[19, 8, 4]}
                        volume={14}
                        color="#111525" />
                    <Cloud
                        segments={40}
                        bounds={[18, 6, 5]}
                        volume={12}
                        color="#000000"
                        fade={100}
                    />
                </Clouds>
            </group>
        </Float>
    </>
}
```

## 12.1.6 - Presentation Controls

1. Object
2. Camera

### 12.1.6.1 - Object

Adds controls to move the object, the configuration created allows it to return to the initial position whenever the user releases the object and resumes its position with an animation of several jumps.

`PresentationControls`

``` javascript

```

### 12.1.6.2 - Camera

Animate the camera in the scene.

``` javascript
import { PresentationControls } from '@react-three/drei'

import MacBook from './MacBook'

<PresentationControls
    global
    polar={ [ -4, 0.2 ]}
    azimuth={ [ -1, 0.75 ] }
    config={ { mass: 2, tension: 400 } }
    snap={ { mass: 4, tension: 400 } }
>
    <MacBook 
        position-y={ -1 }
        position-x={ 0.4 }
    />
</PresentationControls>
```

## 12.1.7 - Shadows

It was not implemented in this project due to it being above the clouds, but it can be easily integrated this way.

If we want the shadow to follow the object we must place it inside that object.

``` javascript
import { ContactShadows } from '@react-three/drei'

<ContactShadows
    position-y={ -1.4 }
    opacity={ 0.4 }
    scale={ 5 }
    blur={ 2.4 }
/>
```

## 12.1.8 - Lights

Add a area light to simulate the screen

``` javascript
<rectAreaLight
    width={ 2.5 }
    height={ 1.65 }
    intensity={ 5 }
    color={ '#a0aff0'}
    position={ [ 0, 0.95, 0.75 ] }
    rotation-x={ -0.50 }
/>
```

## 12.1.9 - Iframe

Associates an HTML page in a plane, An inline frame is used to embed another document within the current HTML document.

Use this [converter](https://gero3.github.io/facetype.js/) to convert [Google Fonts](https://fonts.google.com/) in typeface.json.

Put this inside the object
``` javascript
<Html
    transform
    wrapperClass="htmlScreen"
    distanceFactor={ 0.63 }
    position={ [ 0, 1.55, -1.4 ] }
    rotation-x={ -0.256 }
>
    <iframe src="./Iframe/index.html"/>
</Html>
```

``` javascript
<Text3D
    font="./resources/Fonts/Permanent Marker_Regular.json"
    size={ 0.5 }
    position={ [ 4.5, 0.60, -2.95 ]}
    rotation-y={ -1.25 }
    scale-x={ 1.5 }
    scale-y={1}
    scale-z={1}
    letterSpacing={ 0.02}
>
    Ivan
    <meshMatcapMaterial matcap={ matCapTexture } />
</Text3D>
<Text3D
    font="./resources/Fonts/Permanent Marker_Regular.json"
    size={ 0.5 }
    position={ [ 4.5, 0, -3.61 ]}
    rotation-y={ -1.25 }
    scale-x={ 1.4 }
    scale-y={1}
    scale-z={0.8}
    letterSpacing={ 0.02}
>
    Xavier
    <meshMatcapMaterial matcap={ matCapTexture } />
</Text3D>
```

``` css
.htmlScreen iframe
{
    width: 1890px;
    height: 1220px;
    border: none;
    border-radius: 20px;
    background: black;
}
```


## 12.2 - Physics Game


